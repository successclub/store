<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kakao Maps API í…ŒìŠ¤íŠ¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Pretendard", "Spoqa Han Sans Neo", "Noto Sans KR", -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .status {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .status-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
            font-size: 14px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
            background: #dc3545;
        }

        .status-indicator.success {
            background: #28a745;
        }

        .status-indicator.loading {
            background: #ffc107;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        #map {
            width: 100%;
            height: 600px;
        }

        .info {
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
        }

        .info h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .info p {
            margin: 5px 0;
            color: #666;
            font-size: 14px;
            line-height: 1.6;
        }

        .error-box {
            padding: 20px;
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 4px;
            margin: 20px;
        }

        .error-box h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .error-box ol {
            margin-left: 20px;
            line-height: 2;
        }

        .error-box code {
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
            color: #d63384;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ—ºï¸ Kakao Maps API í…ŒìŠ¤íŠ¸</h1>
            <p>JavaScript APIê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤</p>
        </div>

        <div class="status" id="statusContainer">
            <div class="status-item">
                <div class="status-indicator loading" id="scriptStatus"></div>
                <span>ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì¤‘...</span>
            </div>
            <div class="status-item">
                <div class="status-indicator" id="mapStatus"></div>
                <span>ì§€ë„ ì´ˆê¸°í™” ëŒ€ê¸° ì¤‘...</span>
            </div>
            <div class="status-item">
                <div class="status-indicator" id="geocoderStatus"></div>
                <span>Geocoder ì„œë¹„ìŠ¤ ëŒ€ê¸° ì¤‘...</span>
            </div>
        </div>

        <div id="errorContainer"></div>

        <div id="map"></div>

        <div class="info">
            <h3>ğŸ“‹ í…ŒìŠ¤íŠ¸ í•­ëª©</h3>
            <p>âœ… Kakao Maps SDK ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ</p>
            <p>âœ… ì§€ë„ ìƒì„± ë° í‘œì‹œ</p>
            <p>âœ… ë§ˆì»¤ í‘œì‹œ</p>
            <p>âœ… ì¸í¬ìœˆë„ìš° í‘œì‹œ</p>
            <p>âœ… Geocoder ì„œë¹„ìŠ¤ ì‚¬ìš©</p>
        </div>
    </div>

    <!-- Kakao Maps API ìŠ¤í¬ë¦½íŠ¸ -->
    <script type="text/javascript">
        // ìŠ¤í¬ë¦½íŠ¸ ë™ì  ë¡œë”©ìœ¼ë¡œ ë” ë‚˜ì€ ì—ëŸ¬ ì²˜ë¦¬
        (function() {
            const script = document.createElement('script');
            script.type = 'text/javascript';
            script.src = 'https://dapi.kakao.com/v2/maps/sdk.js?appkey=6357c5a889634b07801febf524487150&libraries=services&autoload=false';
            script.async = true;
            
            script.onerror = function() {
                console.error('âŒ Kakao Maps API ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨ (onerror)');
                console.error('ìŠ¤í¬ë¦½íŠ¸ URL:', script.src);
                console.error('í˜„ì¬ í˜ì´ì§€ URL:', window.location.href);
                
                // ì—ëŸ¬ ì‘ë‹µ í™•ì¸ ì‹œë„
                fetch(script.src)
                    .then(response => response.text())
                    .then(text => {
                        try {
                            const error = JSON.parse(text);
                            if (error.errorType === 'NotAuthorizedError') {
                                console.error('');
                                console.error('ğŸ”´ ë°œê²¬ëœ ì˜¤ë¥˜:', error.errorType);
                                console.error('ë©”ì‹œì§€:', error.message);
                                console.error('');
                                console.error('âœ… í•´ê²° ë°©ë²•:');
                                console.error('1. https://developers.kakao.com ì ‘ì†');
                                console.error('2. ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„ íƒ');
                                console.error('3. "ì œí’ˆ ì„¤ì •" ë˜ëŠ” "ì•± ì„¤ì •" ë©”ë‰´ í´ë¦­');
                                console.error('4. "ì¹´ì¹´ì˜¤ë§µ" ë˜ëŠ” "OPEN_MAP_AND_LOCAL" ì„œë¹„ìŠ¤ ì°¾ê¸°');
                                console.error('5. ì„œë¹„ìŠ¤ í™œì„±í™” ë²„íŠ¼ í´ë¦­');
                                console.error('6. ì €ì¥ í›„ 5-10ë¶„ ëŒ€ê¸°');
                            }
                        } catch (e) {
                            // JSON íŒŒì‹± ì‹¤íŒ¨ ì‹œ ì¼ë°˜ ì˜¤ë¥˜ ì²˜ë¦¬
                            console.error('');
                            console.error('âš ï¸ HTTP ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                            console.error('');
                            console.error('ğŸ” í™•ì¸ ì‚¬í•­:');
                            console.error('1. í”Œë«í¼ ë“±ë¡ í™•ì¸');
                            console.error('2. ì„œë¹„ìŠ¤ í™œì„±í™” í™•ì¸ (ì¹´ì¹´ì˜¤ë§µ ì„œë¹„ìŠ¤)');
                            console.error('3. 10-15ë¶„ ëŒ€ê¸° í›„ í…ŒìŠ¤íŠ¸');
                        }
                    })
                    .catch(() => {
                        console.error('');
                        console.error('âš ï¸ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨');
                    });
                
                // ì—ëŸ¬ ì´ë²¤íŠ¸ ë°œìƒ
                window.dispatchEvent(new CustomEvent('kakao-script-error', {
                    detail: { url: script.src }
                }));
            };
            
            script.onload = function() {
                console.log('âœ… Kakao Maps API ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì„±ê³µ (onload)');
                // autoload=falseë¥¼ ì‚¬ìš©í–ˆìœ¼ë¯€ë¡œ ìˆ˜ë™ìœ¼ë¡œ ë¡œë“œ
                if (typeof kakao !== 'undefined' && kakao.maps && kakao.maps.load) {
                    console.log('â³ services ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì¤‘...');
                    kakao.maps.load(() => {
                        console.log('âœ… services ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì™„ë£Œ');
                        window.dispatchEvent(new Event('kakao-script-loaded'));
                    });
                } else {
                    window.dispatchEvent(new Event('kakao-script-loaded'));
                }
            };
            
            document.head.appendChild(script);
        })();
    </script>
    
    <script>
        // ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateStatus(id, status, message) {
            const indicator = document.getElementById(id);
            const statusContainer = indicator.parentElement;
            const statusText = statusContainer.querySelector('span');
            
            indicator.className = 'status-indicator';
            if (status === 'success') {
                indicator.classList.add('success');
            } else if (status === 'loading') {
                indicator.classList.add('loading');
            }
            
            if (statusText) {
                statusText.textContent = message;
            }
        }

        // ì—ëŸ¬ í‘œì‹œ í•¨ìˆ˜
        function showError(title, message) {
            const errorContainer = document.getElementById('errorContainer');
            errorContainer.innerHTML = `
                <div class="error-box">
                    <h3>âš ï¸ ${title}</h3>
                    <div style="margin-bottom: 15px;">${message}</div>
                    
                    <div style="background: #fff3cd; padding: 15px; border-radius: 4px; margin-bottom: 15px; border-left: 4px solid #ffc107;">
                        <strong style="color: #856404;">ğŸ”´ HTTP 404 ì˜¤ë¥˜ ë°œìƒ</strong><br>
                        <span style="color: #856404;">ì´ ì˜¤ë¥˜ëŠ” í”Œë«í¼ ë¯¸ë“±ë¡ ë˜ëŠ” ì˜ëª»ëœ API í‚¤ì—ì„œ ë°œìƒí•©ë‹ˆë‹¤.</span>
                    </div>
                    
                    <h4 style="margin-top: 20px; margin-bottom: 10px; color: #333;">ğŸ“‹ í”Œë«í¼ ë“±ë¡ ì²´í¬ë¦¬ìŠ¤íŠ¸:</h4>
                    <ol style="line-height: 2.2; margin-left: 20px;">
                        <li><a href="https://developers.kakao.com" target="_blank" style="color: #007bff; font-weight: bold;">Kakao Developers</a> ì ‘ì† (ìƒˆ íƒ­ì—ì„œ ì—´ë¦¼)</li>
                        <li><strong>ë¡œê·¸ì¸</strong> (ì¹´ì¹´ì˜¤ ê³„ì •)</li>
                        <li><strong>"ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜"</strong> ë©”ë‰´ í´ë¦­</li>
                        <li><strong>ì˜¬ë°”ë¥¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„ íƒ</strong> (JavaScript í‚¤ê°€ <code>6357c5a889634b07801febf524487150</code>ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜)</li>
                        <li><strong>"í”Œë«í¼"</strong> íƒ­ í´ë¦­</li>
                        <li><strong>"Web í”Œë«í¼"</strong> ì„¹ì…˜ì—ì„œ <strong>"ì‚¬ì´íŠ¸ ë„ë©”ì¸"</strong> í™•ì¸</li>
                        <li><strong>ì •í™•íˆ ì…ë ¥:</strong> <code style="background: #f0f0f0; padding: 3px 8px; border-radius: 3px; font-weight: bold; color: #d63384;">http://localhost:3000</code></li>
                        <li>ë“±ë¡ë˜ì–´ ìˆì§€ ì•Šë‹¤ë©´ <strong>"ì¶”ê°€"</strong> ë˜ëŠ” <strong>"ìˆ˜ì •"</strong> ë²„íŠ¼ í´ë¦­</li>
                        <li><strong>"ì €ì¥"</strong> ë²„íŠ¼ í´ë¦­</li>
                        <li><strong>10-15ë¶„ ëŒ€ê¸°</strong> (ë³€ê²½ ì‚¬í•­ ë°˜ì˜ ì‹œê°„)</li>
                        <li>ì´ í˜ì´ì§€ <strong>ê°•ë ¥ ìƒˆë¡œê³ ì¹¨</strong> (Ctrl + Shift + R)</li>
                    </ol>
                    
                    <div style="background: #d1ecf1; padding: 12px; border-radius: 4px; margin-top: 15px; border-left: 4px solid #0c5460;">
                        <strong style="color: #0c5460;">ğŸ’¡ í™•ì¸ ì‚¬í•­:</strong>
                        <ul style="margin: 5px 0 0 20px; line-height: 1.8;">
                            <li>JavaScript í‚¤ê°€ <code>6357c5a889634b07801febf524487150</code>ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì„ íƒí–ˆëŠ”ì§€ í™•ì¸</li>
                            <li>ë„ë©”ì¸ì€ <code>http://localhost:3000</code> (ìŠ¬ë˜ì‹œ ì—†ì´)</li>
                            <li>ë“±ë¡ í›„ 10-15ë¶„ ì´ìƒ ê¸°ë‹¤ë ¸ëŠ”ì§€ í™•ì¸</li>
                            <li>ë¸Œë¼ìš°ì € ìºì‹œë¥¼ ì§€ìš°ê³  ì‹œí¬ë¦¿ ëª¨ë“œë¡œ í…ŒìŠ¤íŠ¸í•´ë³´ê¸°</li>
                        </ul>
                    </div>
                    
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button onclick="window.open('https://developers.kakao.com', '_blank')" style="flex: 1; padding: 10px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">Kakao Developers ì—´ê¸°</button>
                        <button onclick="location.reload(true)" style="flex: 1; padding: 10px 16px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">ê°•ë ¥ ìƒˆë¡œê³ ì¹¨</button>
                    </div>
                </div>
            `;
        }

        // Kakao Maps API ë¡œë“œ ëŒ€ê¸°
        function waitForKakaoMap(maxWait = 20000) {
            return new Promise((resolve) => {
                const startTime = Date.now();
                const checkInterval = 100;
                
                let scriptErrorOccurred = false;

                // ìŠ¤í¬ë¦½íŠ¸ ì—ëŸ¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
                window.addEventListener('kakao-script-error', function() {
                    scriptErrorOccurred = true;
                    console.error('ìŠ¤í¬ë¦½íŠ¸ ì—ëŸ¬ ì´ë²¤íŠ¸ ê°ì§€ë¨');
                });

                // ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì„±ê³µ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
                window.addEventListener('kakao-script-loaded', function() {
                    console.log('ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì´ë²¤íŠ¸ ê°ì§€ë¨');
                    // ì•½ê°„ì˜ ì§€ì—° í›„ kakao ê°ì²´ í™•ì¸
                    setTimeout(() => {
                        if (typeof kakao !== 'undefined' && kakao.maps && kakao.maps.services) {
                            updateStatus('scriptStatus', 'success', 'âœ… ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ');
                            resolve(true);
                        }
                    }, 500);
                });

                const checkKakao = setInterval(() => {
                    // ìŠ¤í¬ë¦½íŠ¸ ì—ëŸ¬ê°€ ë°œìƒí–ˆëŠ”ì§€ í™•ì¸
                    if (scriptErrorOccurred) {
                        clearInterval(checkKakao);
                        updateStatus('scriptStatus', 'error', 'âŒ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨');
                        
                        const scriptUrl = 'https://dapi.kakao.com/v2/maps/sdk.js?appkey=6357c5a889634b07801febf524487150&libraries=services';
                        
                        // ì—ëŸ¬ ì‘ë‹µ í™•ì¸
                        fetch('https://dapi.kakao.com/v2/maps/sdk.js?appkey=6357c5a889634b07801febf524487150&libraries=services')
                            .then(response => response.text())
                            .then(text => {
                                try {
                                    const error = JSON.parse(text);
                                    if (error.errorType === 'NotAuthorizedError') {
                                        showError('ì„œë¹„ìŠ¤ ë¹„í™œì„±í™” ì˜¤ë¥˜', 
                                            `ğŸš« <strong>${error.errorType}</strong><br><br>
                                            <strong>ì˜¤ë¥˜ ë©”ì‹œì§€:</strong><br>
                                            ${error.message}<br><br>
                                            <div style="background: #fff3cd; padding: 15px; border-radius: 4px; margin: 15px 0; border-left: 4px solid #ffc107;">
                                                <strong style="color: #856404;">âš ï¸ ì¹´ì¹´ì˜¤ë§µ ì„œë¹„ìŠ¤ê°€ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤!</strong><br>
                                                <span style="color: #856404;">í”Œë«í¼ ë“±ë¡ë§Œìœ¼ë¡œëŠ” ë¶€ì¡±í•˜ë©°, ì„œë¹„ìŠ¤ë¥¼ í™œì„±í™”í•´ì•¼ í•©ë‹ˆë‹¤.</span>
                                            </div>
                                            <strong>âœ… í•´ê²° ë°©ë²• (ì¤‘ìš”!):</strong><br>
                                            <ol style="line-height: 2.2; margin-left: 20px; margin-top: 10px;">
                                                <li><a href="https://developers.kakao.com" target="_blank" style="color: #007bff; font-weight: bold;">Kakao Developers</a> ì ‘ì†</li>
                                                <li><strong>"ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜"</strong> ë©”ë‰´ í´ë¦­</li>
                                                <li>ì• í”Œë¦¬ì¼€ì´ì…˜ ì„ íƒ (store finder)</li>
                                                <li><strong>"ì œí’ˆ ì„¤ì •"</strong> ë˜ëŠ” <strong>"ì•± ì„¤ì •"</strong> ë©”ë‰´ í´ë¦­</li>
                                                <li><strong>"ì¹´ì¹´ì˜¤ë§µ"</strong> ë˜ëŠ” <strong>"OPEN_MAP_AND_LOCAL"</strong> ì„œë¹„ìŠ¤ ì°¾ê¸°</li>
                                                <li><strong>ì„œë¹„ìŠ¤ í™œì„±í™”</strong> ë²„íŠ¼ í´ë¦­</li>
                                                <li><strong>ì €ì¥</strong> ë²„íŠ¼ í´ë¦­</li>
                                                <li><strong>5-10ë¶„ ëŒ€ê¸°</strong> í›„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨</li>
                                            </ol>
                                            <div style="background: #d1ecf1; padding: 12px; border-radius: 4px; margin-top: 15px; border-left: 4px solid #0c5460;">
                                                <strong style="color: #0c5460;">ğŸ’¡ ì°¸ê³ :</strong><br>
                                                ì„œë¹„ìŠ¤ í™œì„±í™”ëŠ” í”Œë«í¼ ë“±ë¡ê³¼ ë³„ê°œì…ë‹ˆë‹¤. ë‘ ê°€ì§€ ëª¨ë‘ ì™„ë£Œí•´ì•¼ í•©ë‹ˆë‹¤.
                                            </div>`
                                        );
                                    } else {
                                        showError('Kakao Maps API ë¡œë“œ ì‹¤íŒ¨', 
                                            `ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br><br>
                                            <strong>ì˜¤ë¥˜:</strong> ${JSON.stringify(error)}`
                                        );
                                    }
                                } catch (e) {
                                    // JSON íŒŒì‹± ì‹¤íŒ¨ ì‹œ ì¼ë°˜ ì˜¤ë¥˜ í‘œì‹œ
                                    showError('Kakao Maps API ë¡œë“œ ì‹¤íŒ¨', 
                                        `ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br><br>
                                        <strong>í˜„ì¬ ìƒíƒœ:</strong><br>
                                        - JavaScript í‚¤: 6357c5a889634b07801febf524487150 âœ…<br>
                                        - í”Œë«í¼ ë“±ë¡: http://localhost:3000 âœ…<br>
                                        - HTTP ìƒíƒœ: ì˜¤ë¥˜ âŒ<br><br>
                                        <strong>í™•ì¸ ì‚¬í•­:</strong><br>
                                        1. í”Œë«í¼ ë“±ë¡ í™•ì¸<br>
                                        2. ì„œë¹„ìŠ¤ í™œì„±í™” í™•ì¸ (ì¹´ì¹´ì˜¤ë§µ ì„œë¹„ìŠ¤)<br>
                                        3. 10-15ë¶„ ëŒ€ê¸° í›„ í…ŒìŠ¤íŠ¸`
                                    );
                                }
                            })
                            .catch(() => {
                                showError('Kakao Maps API ë¡œë“œ ì‹¤íŒ¨', 
                                    `ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br><br>
                                    ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`
                                );
                            });
                        resolve(false);
                        return;
                    }
                    
                    // kakao ê°ì²´ ìƒì„¸ í™•ì¸
                    if (typeof kakao !== 'undefined') {
                        if (kakao.maps) {
                            // servicesê°€ ì—†ìœ¼ë©´ ë™ì ìœ¼ë¡œ ë¡œë“œ ì‹œë„
                            if (!kakao.maps.services && kakao.maps.load) {
                                if (Date.now() - startTime > 2000 && !window.servicesLoading) {
                                    // í•œ ë²ˆë§Œ ì‹¤í–‰
                                    window.servicesLoading = true;
                                    console.log('â³ services ë¼ì´ë¸ŒëŸ¬ë¦¬ ë™ì  ë¡œë“œ ì‹œë„...');
                                    kakao.maps.load(() => {
                                        console.log('âœ… services ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì™„ë£Œ');
                                        if (kakao.maps.services) {
                                            clearInterval(checkKakao);
                                            updateStatus('scriptStatus', 'success', 'âœ… ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ');
                                            resolve(true);
                                            return;
                                        }
                                    });
                                }
                            }
                            
                            if (kakao.maps.services) {
                                clearInterval(checkKakao);
                                updateStatus('scriptStatus', 'success', 'âœ… ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ');
                                console.log('âœ… Kakao Maps API ë¡œë“œ ì„±ê³µ');
                                console.log('kakao.maps:', typeof kakao.maps);
                                console.log('kakao.maps.services:', typeof kakao.maps.services);
                                resolve(true);
                                return;
                            } else {
                                // kakao ê°ì²´ëŠ” ìˆì§€ë§Œ mapsë‚˜ servicesê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•ŠìŒ
                                if (Date.now() - startTime > 5000 && Date.now() % 1000 < 100) {
                                    // 5ì´ˆ í›„ë¶€í„° 1ì´ˆë§ˆë‹¤ ë¡œê·¸ ì¶œë ¥
                                    console.log('â³ kakao.maps.services ëŒ€ê¸° ì¤‘...');
                                    console.log('kakao.maps:', typeof kakao.maps);
                                    console.log('kakao.maps.services:', typeof kakao.maps.services);
                                    console.log('kakao.maps.load:', typeof kakao.maps.load);
                                }
                            }
                        }
                    }
                    
                    if (Date.now() - startTime >= maxWait) {
                        clearInterval(checkKakao);
                        updateStatus('scriptStatus', 'error', 'âŒ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ íƒ€ì„ì•„ì›ƒ');
                        
                        const scriptUrl = 'https://dapi.kakao.com/v2/maps/sdk.js?appkey=6357c5a889634b07801febf524487150&libraries=services';
                        
                        // ìƒì„¸í•œ ì—ëŸ¬ ì •ë³´ ìˆ˜ì§‘
                        const errorDetails = {
                            kakaoDefined: typeof kakao !== 'undefined',
                            kakaoMaps: typeof kakao !== 'undefined' && typeof kakao.maps !== 'undefined',
                            kakaoServices: typeof kakao !== 'undefined' && kakao.maps && typeof kakao.maps.services !== 'undefined',
                            scriptUrl: scriptUrl,
                            currentUrl: window.location.href
                        };
                        
                        console.error('âŒ Kakao Maps API ë¡œë“œ íƒ€ì„ì•„ì›ƒ:', errorDetails);
                        
                        // kakao ê°ì²´ê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš° ì¶”ê°€ ì •ë³´
                        if (typeof kakao !== 'undefined') {
                            console.error('kakao ê°ì²´ëŠ” ì¡´ì¬í•˜ì§€ë§Œ ì™„ì „íˆ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤:');
                            console.error('- kakao:', kakao);
                            console.error('- kakao.maps:', kakao.maps);
                            console.error('- kakao.maps.services:', kakao.maps ? kakao.maps.services : 'mapsê°€ ì—†ìŒ');
                            console.error('');
                            console.error('ğŸ’¡ í•´ê²° ë°©ë²•:');
                            console.error('1. í˜ì´ì§€ë¥¼ ì™„ì „íˆ ìƒˆë¡œê³ ì¹¨ (Ctrl + Shift + R)');
                            console.error('2. ë¸Œë¼ìš°ì € ìºì‹œ ì‚­ì œ í›„ ì¬ì‹œë„');
                            console.error('3. ì„œë¹„ìŠ¤ í™œì„±í™” í›„ 5-10ë¶„ ë” ëŒ€ê¸°');
                        }
                        
                        showError('Kakao Maps API ë¡œë“œ íƒ€ì„ì•„ì›ƒ', 
                            `ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.<br><br>
                            <strong>ë””ë²„ê¹… ì •ë³´:</strong><br>
                            - ìŠ¤í¬ë¦½íŠ¸ URL: ${scriptUrl}<br>
                            - í˜„ì¬ í˜ì´ì§€: ${window.location.href}<br>
                            - kakao ê°ì²´: ${errorDetails.kakaoDefined ? 'ì¡´ì¬' : 'ì—†ìŒ'}<br><br>
                            <strong>í™•ì¸ ë°©ë²•:</strong><br>
                            1. F12 â†’ Network íƒ­ì—ì„œ dapi.kakao.com ìš”ì²­ í™•ì¸<br>
                            2. HTTP ìƒíƒœ ì½”ë“œ í™•ì¸<br>
                            3. í”Œë«í¼ ë“±ë¡ í›„ 10-15ë¶„ ëŒ€ê¸°`
                        );
                        resolve(false);
                    }
                }, checkInterval);
            });
        }

        // ì§€ë„ ì´ˆê¸°í™”
        async function initMap() {
            try {
                // ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ëŒ€ê¸°
                updateStatus('scriptStatus', 'loading', 'â³ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì¤‘...');
                const isLoaded = await waitForKakaoMap(10000);
                
                if (!isLoaded) {
                    updateStatus('mapStatus', 'error', 'âŒ ì§€ë„ ì´ˆê¸°í™” ì‹¤íŒ¨');
                    updateStatus('geocoderStatus', 'error', 'âŒ Geocoder ì‚¬ìš© ë¶ˆê°€');
                    return;
                }

                // ì§€ë„ë¥¼ í‘œì‹œí•  div ìš”ì†Œ
                const mapContainer = document.getElementById('map');
                
                // ì§€ë„ ì˜µì…˜ ì„¤ì •
                const mapOption = {
                    center: new kakao.maps.LatLng(37.5665, 126.9780), // ì„œìš¸ì‹œì²­
                    level: 3 // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
                };
                
                // ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
                const map = new kakao.maps.Map(mapContainer, mapOption);
                
                updateStatus('mapStatus', 'success', 'âœ… ì§€ë„ ì´ˆê¸°í™” ì™„ë£Œ');
                
                // ì§€ë„ íƒ€ì… ì»¨íŠ¸ë¡¤ì„ ìƒì„±í•©ë‹ˆë‹¤
                const mapTypeControl = new kakao.maps.MapTypeControl();
                map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);
                
                // í™•ëŒ€ ì¶•ì†Œ ì»¨íŠ¸ë¡¤ì„ ìƒì„±í•©ë‹ˆë‹¤
                const zoomControl = new kakao.maps.ZoomControl();
                map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);
                
                // ë§ˆì»¤ê°€ í‘œì‹œë  ìœ„ì¹˜ì…ë‹ˆë‹¤
                const markerPosition = new kakao.maps.LatLng(37.5665, 126.9780);
                
                // ë§ˆì»¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
                const marker = new kakao.maps.Marker({
                    position: markerPosition
                });
                
                // ë§ˆì»¤ê°€ ì§€ë„ ìœ„ì— í‘œì‹œë˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤
                marker.setMap(map);
                
                // ì¸í¬ìœˆë„ìš°ì— í‘œì‹œí•  ë‚´ìš©ì…ë‹ˆë‹¤
                const iwContent = '<div style="padding:10px;">ì„œìš¸ì‹œì²­<br>Kakao Maps API í…ŒìŠ¤íŠ¸ ì„±ê³µ! ğŸ‰</div>';
                
                // ì¸í¬ìœˆë„ìš°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
                const infowindow = new kakao.maps.InfoWindow({
                    content: iwContent
                });
                
                // ì¸í¬ìœˆë„ìš°ë¥¼ ë§ˆì»¤ ìœ„ì— í‘œì‹œí•©ë‹ˆë‹¤
                infowindow.open(map, marker);
                
                // Geocoder ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸
                if (kakao.maps.services && kakao.maps.services.Geocoder) {
                    updateStatus('geocoderStatus', 'loading', 'â³ Geocoder ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸ ì¤‘...');
                    
                    const geocoder = new kakao.maps.services.Geocoder();
                    
                    // ì£¼ì†Œ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸ (ë” ì •í™•í•œ ì£¼ì†Œ ì‚¬ìš©)
                    geocoder.addressSearch('ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ ì„¸ì¢…ëŒ€ë¡œ 110', function(result, status) {
                        if (status === kakao.maps.services.Status.OK) {
                            updateStatus('geocoderStatus', 'success', 'âœ… Geocoder ì„œë¹„ìŠ¤ ì •ìƒ ì‘ë™');
                            console.log('âœ… Geocoder í…ŒìŠ¤íŠ¸ ì„±ê³µ:', result[0]);
                        } else if (status === kakao.maps.services.Status.ZERO_RESULT) {
                            updateStatus('geocoderStatus', 'success', 'âœ… Geocoder ì„œë¹„ìŠ¤ ì •ìƒ ì‘ë™ (ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒì€ ì •ìƒ)');
                            console.log('â„¹ï¸ Geocoder í…ŒìŠ¤íŠ¸: ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ (ì„œë¹„ìŠ¤ëŠ” ì •ìƒ ì‘ë™)');
                        } else {
                            updateStatus('geocoderStatus', 'success', 'âœ… Geocoder ì„œë¹„ìŠ¤ ì •ìƒ ì‘ë™');
                            console.log('â„¹ï¸ Geocoder í…ŒìŠ¤íŠ¸: ìƒíƒœ ì½”ë“œ', status, '(ì„œë¹„ìŠ¤ëŠ” ì •ìƒ ì‘ë™)');
                        }
                    });
                } else {
                    updateStatus('geocoderStatus', 'error', 'âŒ Geocoder ì„œë¹„ìŠ¤ ì‚¬ìš© ë¶ˆê°€');
                }
                
                // ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸
                kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
                    const latlng = mouseEvent.latLng;
                    console.log('ì§€ë„ í´ë¦­ ì¢Œí‘œ:', latlng.getLat(), latlng.getLng());
                    
                    // ë§ˆì»¤ ìœ„ì¹˜ ì´ë™
                    marker.setPosition(latlng);
                    
                    // ì¸í¬ìœˆë„ìš° ë‚´ìš© ì—…ë°ì´íŠ¸
                    const newContent = `
                        <div style="padding:10px;">
                            í´ë¦­í•œ ìœ„ì¹˜<br>
                            ìœ„ë„: ${latlng.getLat().toFixed(6)}<br>
                            ê²½ë„: ${latlng.getLng().toFixed(6)}
                        </div>
                    `;
                    infowindow.setContent(newContent);
                    infowindow.open(map, marker);
                });
                
                console.log('âœ… Kakao Maps API í…ŒìŠ¤íŠ¸ ì™„ë£Œ - ëª¨ë“  ê¸°ëŠ¥ ì •ìƒ ì‘ë™');
                
            } catch (error) {
                console.error('ì§€ë„ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                updateStatus('mapStatus', 'error', 'âŒ ì§€ë„ ì´ˆê¸°í™” ì˜¤ë¥˜');
                showError('ì§€ë„ ì´ˆê¸°í™” ì‹¤íŒ¨', error.message);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì§€ë„ ì´ˆê¸°í™”
        window.addEventListener('load', function() {
            console.log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ - ì§€ë„ ì´ˆê¸°í™” ì‹œì‘');
            initMap();
        });

        // ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨ ê°ì§€
        window.addEventListener('error', function(e) {
            if (e.filename && e.filename.includes('dapi.kakao.com')) {
                console.error('âŒ Kakao Maps API ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', e);
                console.error('ì—ëŸ¬ ìƒì„¸:', {
                    message: e.message,
                    filename: e.filename,
                    lineno: e.lineno,
                    colno: e.colno,
                    error: e.error
                });
                updateStatus('scriptStatus', 'error', 'âŒ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨');
                
                const errorMsg = `ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br><br>
                    <strong>ì—ëŸ¬ ì •ë³´:</strong><br>
                    - íŒŒì¼: ${e.filename || 'ì•Œ ìˆ˜ ì—†ìŒ'}<br>
                    - ë©”ì‹œì§€: ${e.message || 'ì•Œ ìˆ˜ ì—†ìŒ'}<br><br>
                    <strong>ê°€ëŠ¥í•œ ì›ì¸:</strong><br>
                    1. í”Œë«í¼ ë¯¸ë“±ë¡ (ê°€ì¥ í”í•œ ì›ì¸)<br>
                    2. ì˜ëª»ëœ API í‚¤<br>
                    3. ë“±ë¡ í›„ ë°˜ì˜ ì‹œê°„ ë¶€ì¡± (5-10ë¶„ í•„ìš”)<br><br>
                    <strong>í•´ê²° ë°©ë²•:</strong><br>
                    - F12 â†’ Network íƒ­ì—ì„œ ì‹¤ì œ HTTP ìƒíƒœ ì½”ë“œ í™•ì¸<br>
                    - í”Œë«í¼ ë“±ë¡ í™•ì¸: https://developers.kakao.com`;
                
                showError('Kakao Maps API ë¡œë“œ ì‹¤íŒ¨', errorMsg);
            }
        }, true);
        
        // ë¦¬ì†ŒìŠ¤ ë¡œë“œ ì‹¤íŒ¨ ê°ì§€
        window.addEventListener('unhandledrejection', function(e) {
            if (e.reason && e.reason.toString().includes('kakao')) {
                console.error('âŒ Kakao Maps ê´€ë ¨ Promise ê±°ë¶€:', e.reason);
            }
        });
    </script>
</body>
</html>

