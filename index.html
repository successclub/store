<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="ê°€ê²Œ ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ ë° ì§€ë„ í‘œì‹œ ì•±">
    <title>ê°€ê²Œ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Pretendard", "Spoqa Han Sans Neo", "Noto Sans KR", -apple-system, BlinkMacSystemFont, sans-serif;
            background: #1a1a2e;
            color: #ffffff;
            overflow-x: hidden;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 100%;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .header h1 {
            font-size: 1.5rem;
            margin: 0;
        }

        .add-store-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            background: #fff;
            color: #667eea;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .add-store-btn:hover {
            background: #f0f0f0;
            transform: scale(1.05);
        }

        .search-container {
            display: flex;
            gap: 10px;
        }

        .search-input {
            flex: 1;
            padding: 12px 16px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            outline: none;
        }

        .search-input::placeholder {
            color: #999;
        }

        .search-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            background: #fff;
            color: #667eea;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .search-btn:hover {
            background: #f0f0f0;
            transform: scale(1.05);
        }

        .category-filter-wrapper {
            margin-bottom: 15px;
        }

        .category-filter-header {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .category-filter-header:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .category-filter-container {
            margin-top: 10px;
        }

        .category-filter-btn {
            padding: 8px 16px;
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-weight: 500;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .category-filter-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.8);
        }

        .category-filter-btn.active {
            background: rgba(255, 255, 255, 0.9);
            color: #667eea;
            border-color: white;
            font-weight: 600;
        }

        .map-container {
            flex: 1;
            position: relative;
            width: 100%;
            min-height: 400px;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .store-list {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(10px);
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            max-height: 40vh;
            overflow-y: auto;
            transform: translateY(calc(100% - 60px));
            transition: transform 0.3s ease;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
        }

        .store-list.expanded {
            transform: translateY(0);
        }

        .store-list-header {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
        }

        .store-list-header h2 {
            font-size: 1.1rem;
            margin: 0;
        }

        .store-list-header .toggle-icon {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .store-list.expanded .toggle-icon {
            transform: rotate(180deg);
        }

        .store-list-content {
            padding: 10px;
        }

        .store-item {
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .store-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .store-item h3 {
            font-size: 1rem;
            margin-bottom: 5px;
            color: #fff;
        }

        .store-item p {
            font-size: 0.85rem;
            color: #aaa;
            margin: 3px 0;
        }

        .store-item-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }

        .store-item-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .edit-btn {
            background: #667eea;
            color: white;
        }

        .delete-btn {
            background: #ff6b6b;
            color: white;
        }

        .store-item-btn:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }

        .loading {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 20px 30px;
            border-radius: 10px;
            z-index: 2000;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            display: none;
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #ff6b6b;
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            font-size: 0.9rem;
        }

        .error-message.active {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #2a2a3e;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            font-size: 1.5rem;
            margin: 0;
            color: #fff;
        }

        .close-btn {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: #aaa;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 1rem;
            outline: none;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: #666;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-secondary {
            background: #555;
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
            transform: scale(1.02);
        }

        @media (max-width: 480px) {
            .header {
                padding: 15px !important;
            }

            .header-top {
                flex-direction: column !important;
                align-items: flex-start !important;
                gap: 15px !important;
            }

            .header h1 {
                font-size: 1.2rem !important;
            }

            .header-top > div:last-child {
                width: 100% !important;
            }

            .header-top > div:last-child > div {
                flex-wrap: wrap !important;
                gap: 8px !important;
                width: 100% !important;
            }

            #loginForm {
                flex-wrap: wrap !important;
                width: 100% !important;
            }

            #loginForm input {
                flex: 1 !important;
                min-width: 80px !important;
                width: auto !important;
            }

            #loginForm button {
                flex: 1 !important;
                min-width: 100px !important;
            }

            #userInfo {
                flex-wrap: wrap !important;
                width: 100% !important;
            }

            #userInfo button {
                flex: 1 !important;
                min-width: 80px !important;
            }

            .search-input {
                font-size: 0.9rem;
            }

            .search-btn {
                padding: 12px 16px;
                font-size: 0.9rem;
            }

            .modal-content {
                padding: 20px;
            }
        }

        .store-list::-webkit-scrollbar {
            width: 6px;
        }

        .store-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        .store-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }

        .store-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-top" style="position: relative;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <!-- Pi Network ê³µì‹ ë¡œê³  ë§ˆí¬ -->
                    <div style="width: 52px; height: 52px; background: linear-gradient(135deg, #59B3FF 0%, #1E88E5 50%, #0D47A1 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 18px rgba(0,0,0,0.4), inset 0 2px 5px rgba(255,255,255,0.5), inset 0 -2px 5px rgba(0,0,0,0.2); position: relative; overflow: hidden; border: 2.5px solid rgba(255,255,255,0.4);">
                        <!-- Pi Network ê³µì‹ Ï€ ë§ˆí¬ -->
                        <svg width="38" height="38" viewBox="0 0 38 38" style="filter: drop-shadow(0 2px 5px rgba(0,0,0,0.4)); position: relative; z-index: 2;">
                            <defs>
                                <linearGradient id="piGradientMain" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style="stop-color:#ffffff;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#e8e8e8;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <text x="19" y="27" font-family="'Times New Roman', Times, serif" font-size="34" font-weight="900" fill="url(#piGradientMain)" text-anchor="middle" dominant-baseline="central" style="font-style: italic; letter-spacing: -1.5px; stroke: rgba(0,0,0,0.15); stroke-width: 0.8;">Ï€</text>
                        </svg>
                        <!-- ë°˜ì§ì´ëŠ” í•˜ì´ë¼ì´íŠ¸ íš¨ê³¼ (Pi Network ìŠ¤íƒ€ì¼) -->
                        <div style="position: absolute; top: 12%; left: 18%; width: 32%; height: 32%; background: radial-gradient(circle, rgba(255,255,255,0.7) 0%, rgba(255,255,255,0.3) 50%, transparent 100%); border-radius: 50%; pointer-events: none; z-index: 1;"></div>
                        <!-- ì¶”ê°€ ê´‘íƒ íš¨ê³¼ -->
                        <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; border-radius: 50%; background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 60%); pointer-events: none; z-index: 1;"></div>
                    </div>
                    <h1 style="margin: 0; font-size: 1.6rem; font-weight: 700; text-shadow: 0 2px 6px rgba(0,0,0,0.3); letter-spacing: -0.5px;">íŒŒì´ GCV ê²°ì œ store</h1>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <!-- ë¡œê·¸ì¸ ìƒíƒœ í‘œì‹œ -->
                    <div id="userInfo" style="display: none; color: white; font-size: 0.9rem; margin-right: 10px;">
                        <span id="usernameDisplay"></span>
                        <button id="userInfoButton" onclick="openUserInfoModal()" style="margin-left: 10px; padding: 5px 10px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); border-radius: 5px; color: white; cursor: pointer; font-size: 0.85rem;">ë‚´ ì •ë³´</button>
                        <button onclick="logout()" style="margin-left: 5px; padding: 5px 10px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); border-radius: 5px; color: white; cursor: pointer; font-size: 0.85rem;">ë¡œê·¸ì•„ì›ƒ</button>
                    </div>
                    <!-- ë¡œê·¸ì¸ í¼ -->
                    <div id="loginForm" style="display: flex; gap: 8px; align-items: center;">
                        <input type="text" id="loginUsername" placeholder="ì•„ì´ë””" style="padding: 8px 12px; border: none; border-radius: 15px; font-size: 0.85rem; width: 100px; background: rgba(255,255,255,0.9); color: #333;">
                        <input type="password" id="loginPassword" placeholder="ë¹„ë°€ë²ˆí˜¸" style="padding: 8px 12px; border: none; border-radius: 15px; font-size: 0.85rem; width: 100px; background: rgba(255,255,255,0.9); color: #333;">
                        <button onclick="handleLogin()" style="padding: 8px 16px; border: none; border-radius: 15px; background: rgba(255,255,255,0.9); color: #667eea; font-weight: 600; font-size: 0.85rem; cursor: pointer;">ë¡œê·¸ì¸</button>
                        <button onclick="openRegisterModal()" style="padding: 8px 16px; border: 1px solid rgba(255,255,255,0.5); border-radius: 15px; background: rgba(255,255,255,0.2); color: white; font-weight: 600; font-size: 0.85rem; cursor: pointer;">ê°€ê²Œ ì¶”ê°€</button>
                    </div>
                </div>
            </div>
            <div class="category-filter-wrapper" style="margin-bottom: 15px;">
                <div class="category-filter-header" onclick="toggleCategoryFilter()" style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px 12px; background: rgba(255, 255, 255, 0.1); border-radius: 8px; transition: all 0.3s ease;">
                    <span style="color: white; font-weight: 600; font-size: 0.9rem;">ì¹´í…Œê³ ë¦¬ í•„í„°</span>
                    <span id="categoryToggleIcon" style="color: white; font-size: 0.8rem; transition: transform 0.3s ease;">â–¶</span>
                </div>
                <div class="category-filter-container" id="categoryFilterContainer" style="display: none; margin-top: 10px;">
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                        <span style="color: white; font-weight: 600; font-size: 0.9rem;">ì¹´í…Œê³ ë¦¬:</span>
                        <button class="category-filter-btn active" data-category="all" onclick="filterByCategory('all')">ì „ì²´ë³´ê¸°</button>
                    </div>
                </div>
            </div>
            <div class="search-container">
                <input 
                    type="text" 
                    class="search-input" 
                    id="addressInput" 
                    placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì—¬ ìœ„ì¹˜ í™•ì¸ (ì˜ˆ: ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™)"
                    autocomplete="off"
                >
                <button class="search-btn" id="searchBtn">ê²€ìƒ‰</button>
            </div>
        </div>

        <div class="map-container">
            <div id="map"></div>
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <div>ë¡œë”© ì¤‘...</div>
            </div>
            <div class="error-message" id="errorMessage"></div>
        </div>

        <div class="store-list" id="storeList">
            <div class="store-list-header" id="storeListHeader">
                <h2>ë“±ë¡ëœ ê°€ê²Œ ëª©ë¡ (<span id="storeCount">0</span>)</h2>
                <span class="toggle-icon">â–¼</span>
            </div>
            <div class="store-list-content" id="storeListContent">
                <div style="padding: 20px; text-align: center; color: #aaa;">
                    ë¡œë”© ì¤‘...
                </div>
            </div>
        </div>
    </div>

    <!-- ê°€ê²Œ ì¶”ê°€ ëª¨ë‹¬ -->
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ê°€ê²Œ ì¶”ê°€</h2>
                <button class="close-btn" onclick="closeRegisterModal()">&times;</button>
            </div>
            <form id="registerForm" novalidate>
                <h3 style="color: #fff; margin-bottom: 15px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">ê¸°ë³¸ ì •ë³´</h3>
                <div class="form-group">
                    <label>ì„±ëª… *</label>
                    <input type="text" id="registerName" required placeholder="ì„±ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="name">
                </div>
                <div class="form-group">
                    <label>ì•„ì´ë”” *</label>
                    <input type="text" id="registerUsername" required placeholder="3ì ì´ìƒ ì…ë ¥í•˜ì„¸ìš”" minlength="3" autocomplete="username">
                </div>
                <div class="form-group">
                    <label>ë¹„ë°€ë²ˆí˜¸ *</label>
                    <input type="password" id="registerPassword" required placeholder="4ì ì´ìƒ ì…ë ¥í•˜ì„¸ìš”" minlength="4" autocomplete="new-password">
                </div>
                <div class="form-group">
                    <label>ë¹„ë°€ë²ˆí˜¸ í™•ì¸ *</label>
                    <input type="password" id="registerPasswordConfirm" required placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”" autocomplete="new-password">
                </div>
                
                <h3 style="color: #fff; margin-top: 30px; margin-bottom: 15px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">ê°€ê²Œ ì •ë³´</h3>
                <div class="form-group">
                    <label>ìƒí˜¸ *</label>
                    <input type="text" id="registerStoreName" required placeholder="ë§¤ì¥ ìƒí˜¸ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="form-group">
                    <label>ë¶„ë¥˜ *</label>
                    <select id="registerStoreCategory" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; background: white; color: #333;" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="PC, ë…¸íŠ¸ë¶ , ê²Œì„">PC, ë…¸íŠ¸ë¶ , ê²Œì„</option>
                        <option value="ê°€ì „, íœ´ëŒ€í°">ê°€ì „, íœ´ëŒ€í°</option>
                        <option value="íŒ¨ì…˜ , ì¡í™”">íŒ¨ì…˜ , ì¡í™”</option>
                        <option value="í”¼ë¶€,í—¤ì–´, ë¯¸ìš©, í™”ì¥í’ˆ">í”¼ë¶€,í—¤ì–´, ë¯¸ìš©, í™”ì¥í’ˆ</option>
                        <option value="ê±´ì„¤, ì¸í…Œë¦¬ì–´, ë¶€ë™ì‚°">ê±´ì„¤, ì¸í…Œë¦¬ì–´, ë¶€ë™ì‚°</option>
                        <option value="ì™¸ì‹ì—…, ê¹Œí˜">ì™¸ì‹ì—…, ê¹Œí˜</option>
                        <option value="ìë™ì°¨ ê´€ë ¨">ìë™ì°¨ ê´€ë ¨</option>
                        <option value="ì—¬í–‰ , ë ˆì ¸ , ë„ì„œ">ì—¬í–‰ , ë ˆì ¸ , ë„ì„œ</option>
                        <option value="ìˆ™ë°•">ìˆ™ë°•</option>
                        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                        <option value="ì˜ë£Œê´€ë ¨">ì˜ë£Œê´€ë ¨</option>
                        <option value="ë²•ë¥ í–‰ì • ì„œë¹„ìŠ¤">ë²•ë¥ í–‰ì • ì„œë¹„ìŠ¤</option>
                        <option value="ì‚¬ì£¼, ìš´ì„¸, ì‘ëª…, íƒ€ë¡œ">ì‚¬ì£¼, ìš´ì„¸, ì‘ëª…, íƒ€ë¡œ</option>
                        <option value="ìŠ¤í¬ì¸  , ì·¨ë¯¸, ê±´ê°•">ìŠ¤í¬ì¸  , ì·¨ë¯¸, ê±´ê°•</option>
                        <option value="ì‹í’ˆ, ê±´ê°•ì‹í’ˆë“±">ì‹í’ˆ, ê±´ê°•ì‹í’ˆë“±</option>
                        <option value="ì‚¬ë¬´ê¸°ê¸°">ì‚¬ë¬´ê¸°ê¸°</option>
                        <option value="ì œì¡°">ì œì¡°</option>
                        <option value="ë°˜ë ¤ê²¬,ë¬˜ ê´€ë ¨">ë°˜ë ¤ê²¬,ë¬˜ ê´€ë ¨</option>
                        <option value="êµìœ¡">êµìœ¡</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ì£¼ì†Œ *</label>
                    <input type="text" id="registerStoreAddress" required placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123 ë˜ëŠ” ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™ 123-45)">
                    <button type="button" class="btn btn-secondary" onclick="searchAddressFromRegisterModal()" style="margin-top: 10px; width: 100%;">ì£¼ì†Œ ê²€ìƒ‰ì„ í´ë¦­í•´ ì£¼ì„¸ìš”</button>
                </div>
                <div class="form-group" style="display: none;">
                    <label>ë„ë¡œëª… ì£¼ì†Œ</label>
                    <input type="text" id="registerStoreRoadAddress" placeholder="ë„ë¡œëª… ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="form-group" style="display: none;">
                    <label>ì§€ë²ˆ ì£¼ì†Œ</label>
                    <input type="text" id="registerStoreLotAddress" placeholder="ì§€ë²ˆ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="form-group" style="display: none;">
                    <label>ìœ„ë„ *</label>
                    <input type="number" id="registerStoreLatitude" step="any" placeholder="37.5665">
                </div>
                <div class="form-group" style="display: none;">
                    <label>ê²½ë„ *</label>
                    <input type="number" id="registerStoreLongitude" step="any" placeholder="126.9780">
                </div>
                <div class="form-group">
                    <label>ì „í™”ë²ˆí˜¸</label>
                    <input type="tel" id="registerStorePhone" placeholder="02-1234-5678">
                </div>
                <div class="form-group">
                    <label>ì´ë©”ì¼</label>
                    <input type="email" id="registerStoreEmail" placeholder="example@email.com">
                </div>
                <div class="form-group">
                    <label>ì„¤ëª…</label>
                    <textarea id="registerStoreDescription" placeholder="ê°€ê²Œì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeRegisterModal()">ì·¨ì†Œ</button>
                    <button type="button" id="registerSubmitBtn" class="btn btn-primary" onclick="handleRegisterButtonClick(event)">ê°€ì…</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ì‚¬ìš©ì ì •ë³´ ìˆ˜ì • ëª¨ë‹¬ -->
    <div class="modal" id="userInfoModal">
        <div class="modal-content" style="max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2>ë‚´ ì •ë³´ ìˆ˜ì •</h2>
                <button class="close-btn" onclick="closeUserInfoModal()">&times;</button>
            </div>
            <form id="userInfoForm" onsubmit="handleUserInfoUpdate(event)" novalidate>
                <h3 style="color: #fff; margin-bottom: 15px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">ê¸°ë³¸ ì •ë³´</h3>
                <div class="form-group">
                    <label>ì„±ëª…</label>
                    <input type="text" id="userInfoName" placeholder="ì„±ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="name">
                </div>
                <div class="form-group">
                    <label>ì•„ì´ë””</label>
                    <input type="text" id="userInfoUsername" readonly style="background: rgba(255,255,255,0.1);">
                </div>
                <div class="form-group">
                    <label>í˜„ì¬ ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="userInfoCurrentPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì‹œ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="form-group">
                    <label>ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="userInfoNewPassword" placeholder="4ì ì´ìƒ ì…ë ¥í•˜ì„¸ìš”" minlength="4">
                </div>
                <div class="form-group">
                    <label>ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                    <input type="password" id="userInfoNewPasswordConfirm" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <h3 style="color: #fff; margin-top: 30px; margin-bottom: 15px; border-bottom: 2px solid #667eea; padding-bottom: 10px;">ê°€ê²Œ ì •ë³´</h3>
                <div class="form-group">
                    <label>ìƒí˜¸ *</label>
                    <input type="text" id="userInfoStoreName" required placeholder="ë§¤ì¥ ìƒí˜¸ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="form-group">
                    <label>ë¶„ë¥˜ *</label>
                    <select id="userInfoStoreCategory" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; background: white; color: #333;" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="PC, ë…¸íŠ¸ë¶ , ê²Œì„">PC, ë…¸íŠ¸ë¶ , ê²Œì„</option>
                        <option value="ê°€ì „, íœ´ëŒ€í°">ê°€ì „, íœ´ëŒ€í°</option>
                        <option value="íŒ¨ì…˜ , ì¡í™”">íŒ¨ì…˜ , ì¡í™”</option>
                        <option value="í”¼ë¶€,í—¤ì–´, ë¯¸ìš©, í™”ì¥í’ˆ">í”¼ë¶€,í—¤ì–´, ë¯¸ìš©, í™”ì¥í’ˆ</option>
                        <option value="ê±´ì„¤, ì¸í…Œë¦¬ì–´, ë¶€ë™ì‚°">ê±´ì„¤, ì¸í…Œë¦¬ì–´, ë¶€ë™ì‚°</option>
                        <option value="ì™¸ì‹ì—…, ê¹Œí˜">ì™¸ì‹ì—…, ê¹Œí˜</option>
                        <option value="ìë™ì°¨ ê´€ë ¨">ìë™ì°¨ ê´€ë ¨</option>
                        <option value="ì—¬í–‰ , ë ˆì ¸ , ë„ì„œ">ì—¬í–‰ , ë ˆì ¸ , ë„ì„œ</option>
                        <option value="ìˆ™ë°•">ìˆ™ë°•</option>
                        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                        <option value="ì˜ë£Œê´€ë ¨">ì˜ë£Œê´€ë ¨</option>
                        <option value="ë²•ë¥ í–‰ì • ì„œë¹„ìŠ¤">ë²•ë¥ í–‰ì • ì„œë¹„ìŠ¤</option>
                        <option value="ì‚¬ì£¼, ìš´ì„¸, ì‘ëª…, íƒ€ë¡œ">ì‚¬ì£¼, ìš´ì„¸, ì‘ëª…, íƒ€ë¡œ</option>
                        <option value="ìŠ¤í¬ì¸  , ì·¨ë¯¸, ê±´ê°•">ìŠ¤í¬ì¸  , ì·¨ë¯¸, ê±´ê°•</option>
                        <option value="ì‹í’ˆ, ê±´ê°•ì‹í’ˆë“±">ì‹í’ˆ, ê±´ê°•ì‹í’ˆë“±</option>
                        <option value="ì‚¬ë¬´ê¸°ê¸°">ì‚¬ë¬´ê¸°ê¸°</option>
                        <option value="ì œì¡°">ì œì¡°</option>
                        <option value="ë°˜ë ¤ê²¬,ë¬˜ ê´€ë ¨">ë°˜ë ¤ê²¬,ë¬˜ ê´€ë ¨</option>
                        <option value="êµìœ¡">êµìœ¡</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ì£¼ì†Œ *</label>
                    <input type="text" id="userInfoStoreAddress" required placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    <button type="button" class="btn btn-secondary" onclick="searchAddressFromUserInfoModal()" style="margin-top: 10px; width: 100%;">ì£¼ì†Œ ê²€ìƒ‰ì„ í´ë¦­í•´ ì£¼ì„¸ìš”</button>
                </div>
                <div class="form-group" style="display: none;">
                    <label>ë„ë¡œëª… ì£¼ì†Œ</label>
                    <input type="text" id="userInfoStoreRoadAddress" placeholder="ë„ë¡œëª… ì£¼ì†Œ">
                </div>
                <div class="form-group" style="display: none;">
                    <label>ì§€ë²ˆ ì£¼ì†Œ</label>
                    <input type="text" id="userInfoStoreLotAddress" placeholder="ì§€ë²ˆ ì£¼ì†Œ">
                </div>
                <div class="form-group" style="display: none;">
                    <label>ìœ„ë„ *</label>
                    <input type="number" id="userInfoStoreLatitude" step="any">
                </div>
                <div class="form-group" style="display: none;">
                    <label>ê²½ë„ *</label>
                    <input type="number" id="userInfoStoreLongitude" step="any">
                </div>
                <div class="form-group">
                    <label>ì „í™”ë²ˆí˜¸</label>
                    <input type="tel" id="userInfoStorePhone" placeholder="02-1234-5678">
                </div>
                <div class="form-group">
                    <label>ì´ë©”ì¼</label>
                    <input type="email" id="userInfoStoreEmail" placeholder="example@email.com">
                </div>
                <div class="form-group">
                    <label>ì„¤ëª…</label>
                    <textarea id="userInfoStoreDescription" placeholder="ê°€ê²Œì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeUserInfoModal()">ì·¨ì†Œ</button>
                    <button type="submit" class="btn btn-primary">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ê°€ê²Œ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ (ì‚¬ìš©í•˜ì§€ ì•ŠìŒ) -->
    <div class="modal" id="storeModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">ê°€ê²Œ ì¶”ê°€</h2>
                <button class="close-btn" onclick="closeStoreModal()">&times;</button>
            </div>
            <form id="storeForm" onsubmit="handleStoreSubmit(event)" novalidate>
                <input type="hidden" id="storeId">
                <div class="form-group">
                    <label>ìƒí˜¸ *</label>
                    <input type="text" id="storeName" required placeholder="ë§¤ì¥ ìƒí˜¸ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="form-group">
                    <label>ë¶„ë¥˜ *</label>
                    <select id="storeCategory" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; background: white; color: #333;" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="PC, ë…¸íŠ¸ë¶ , ê²Œì„">PC, ë…¸íŠ¸ë¶ , ê²Œì„</option>
                        <option value="ê°€ì „, íœ´ëŒ€í°">ê°€ì „, íœ´ëŒ€í°</option>
                        <option value="íŒ¨ì…˜ , ì¡í™”">íŒ¨ì…˜ , ì¡í™”</option>
                        <option value="í”¼ë¶€,í—¤ì–´, ë¯¸ìš©, í™”ì¥í’ˆ">í”¼ë¶€,í—¤ì–´, ë¯¸ìš©, í™”ì¥í’ˆ</option>
                        <option value="ê±´ì„¤, ì¸í…Œë¦¬ì–´, ë¶€ë™ì‚°">ê±´ì„¤, ì¸í…Œë¦¬ì–´, ë¶€ë™ì‚°</option>
                        <option value="ì™¸ì‹ì—…, ê¹Œí˜">ì™¸ì‹ì—…, ê¹Œí˜</option>
                        <option value="ìë™ì°¨ ê´€ë ¨">ìë™ì°¨ ê´€ë ¨</option>
                        <option value="ì—¬í–‰ , ë ˆì ¸ , ë„ì„œ">ì—¬í–‰ , ë ˆì ¸ , ë„ì„œ</option>
                        <option value="ìˆ™ë°•">ìˆ™ë°•</option>
                        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                        <option value="ì˜ë£Œê´€ë ¨">ì˜ë£Œê´€ë ¨</option>
                        <option value="ë²•ë¥ í–‰ì • ì„œë¹„ìŠ¤">ë²•ë¥ í–‰ì • ì„œë¹„ìŠ¤</option>
                        <option value="ì‚¬ì£¼, ìš´ì„¸, ì‘ëª…, íƒ€ë¡œ">ì‚¬ì£¼, ìš´ì„¸, ì‘ëª…, íƒ€ë¡œ</option>
                        <option value="ìŠ¤í¬ì¸  , ì·¨ë¯¸, ê±´ê°•">ìŠ¤í¬ì¸  , ì·¨ë¯¸, ê±´ê°•</option>
                        <option value="ì‹í’ˆ, ê±´ê°•ì‹í’ˆë“±">ì‹í’ˆ, ê±´ê°•ì‹í’ˆë“±</option>
                        <option value="ì‚¬ë¬´ê¸°ê¸°">ì‚¬ë¬´ê¸°ê¸°</option>
                        <option value="ì œì¡°">ì œì¡°</option>
                        <option value="ë°˜ë ¤ê²¬,ë¬˜ ê´€ë ¨">ë°˜ë ¤ê²¬,ë¬˜ ê´€ë ¨</option>
                        <option value="êµìœ¡">êµìœ¡</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ì£¼ì†Œ *</label>
                    <input type="text" id="storeAddress" required placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123 ë˜ëŠ” ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™ 123-45)">
                    <button type="button" class="btn btn-secondary" onclick="searchAddressFromModal()" style="margin-top: 10px; width: 100%;">ì£¼ì†Œ ê²€ìƒ‰</button>
                </div>
                <div class="form-group" style="display: none;">
                    <label>ë„ë¡œëª… ì£¼ì†Œ</label>
                    <input type="text" id="storeRoadAddress" placeholder="ë„ë¡œëª… ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="form-group" style="display: none;">
                    <label>ì§€ë²ˆ ì£¼ì†Œ</label>
                    <input type="text" id="storeLotAddress" placeholder="ì§€ë²ˆ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <div class="form-group" style="display: none;">
                    <label>ìœ„ë„ *</label>
                    <input type="number" id="storeLatitude" step="any" placeholder="37.5665">
                </div>
                <div class="form-group" style="display: none;">
                    <label>ê²½ë„ *</label>
                    <input type="number" id="storeLongitude" step="any" placeholder="126.9780">
                </div>
                <div class="form-group">
                    <label>ì „í™”ë²ˆí˜¸</label>
                    <input type="tel" id="storePhone" placeholder="02-1234-5678">
                </div>
                <div class="form-group">
                    <label>ì´ë©”ì¼</label>
                    <input type="email" id="storeEmail" placeholder="example@email.com">
                </div>
                <div class="form-group">
                    <label>ì„¤ëª…</label>
                    <textarea id="storeDescription" placeholder="ê°€ê²Œì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeStoreModal()">ì·¨ì†Œ</button>
                    <button type="submit" class="btn btn-primary">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Kakao Maps API - ì§€ë„ ë° Geocoding -->
    <!-- ì°¸ê³ : https://apis.map.kakao.com/web/guide/ -->
    <!-- ì¤‘ìš”: Kakao Developersì—ì„œ í”Œë«í¼ ë“±ë¡ í•„ìš” (http://localhost:3000) -->
    <script type="text/javascript">
        // ë™ì  ìŠ¤í¬ë¦½íŠ¸ ë¡œë”©ìœ¼ë¡œ ë” ë‚˜ì€ ì—ëŸ¬ ì²˜ë¦¬
        (function() {
            const script = document.createElement('script');
            script.type = 'text/javascript';
            // https://ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ í”„ë¡œí† ì½œ ë¬¸ì œ ë°©ì§€
            script.src = 'https://dapi.kakao.com/v2/maps/sdk.js?appkey=6357c5a889634b07801febf524487150&libraries=services&autoload=false';
            script.async = true;
            
            script.onerror = function() {
                console.error('âŒ Kakao Maps API ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨');
                console.error('ìŠ¤í¬ë¦½íŠ¸ URL:', script.src);
                console.error('í˜„ì¬ í˜ì´ì§€ URL:', window.location.href);
                
                // ì‹¤ì œ HTTP ìƒíƒœ ì½”ë“œ í™•ì¸ ì‹œë„
                fetch(script.src, { method: 'HEAD', mode: 'no-cors' })
                    .then(() => {
                        console.error('ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì€ ê°€ëŠ¥í•˜ì§€ë§Œ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨');
                        console.error('â†’ í”Œë«í¼ ë“±ë¡ ë˜ëŠ” API í‚¤ ë¬¸ì œ ê°€ëŠ¥ì„± ë†’ìŒ');
                    })
                    .catch((err) => {
                        console.error('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:', err);
                    });
                
                console.error('');
                console.error('ğŸ” HTTP ìƒíƒœ ì½”ë“œë³„ ì˜ë¯¸:');
                console.error('   - 404 = API í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜, í”Œë«í¼ ë¯¸ë“±ë¡ (ê°€ì¥ í”í•œ ì›ì¸)');
                console.error('   - 403 = í”Œë«í¼ ë¯¸ë“±ë¡ (ë„ë©”ì¸ ë¯¸ë“±ë¡)');
                console.error('   - 401 = API í‚¤ ì˜¤ë¥˜');
                console.error('');
                console.error('âœ… í•´ê²° ë°©ë²•:');
                console.error('1. https://developers.kakao.com ì ‘ì†');
                console.error('2. ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„ íƒ');
                console.error('3. í”Œë«í¼ ì„¤ì • â†’ Web í”Œë«í¼ ë“±ë¡');
                console.error(`4. ì‚¬ì´íŠ¸ ë„ë©”ì¸ ë“±ë¡: ${window.location.origin}`);
                console.error('5. JavaScript í‚¤ í™•ì¸: 6357c5a889634b07801febf524487150');
                console.error('6. ë“±ë¡ í›„ 5-10ë¶„ ëŒ€ê¸° í›„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨');
                console.error('');
                console.error('ğŸ’¡ ë””ë²„ê¹… íŒ:');
                console.error('   - ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬(F12) â†’ Network íƒ­');
                console.error('   - dapi.kakao.com/v2/maps/sdk.js ìš”ì²­ í´ë¦­');
                console.error('   - Headers íƒ­ì—ì„œ ì‹¤ì œ HTTP ìƒíƒœ ì½”ë“œ í™•ì¸');
                
                // ì‚¬ìš©ìì—ê²Œ ëª…í™•í•œ ë©”ì‹œì§€ í‘œì‹œ
                if (!document.getElementById('kakao-api-error')) {
                    const errorDiv = document.createElement('div');
                    errorDiv.id = 'kakao-api-error';
                    errorDiv.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #fff; padding: 25px; border: 2px solid #ff0000; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 10000; max-width: 600px; font-family: Arial, sans-serif; max-height: 90vh; overflow-y: auto;';
                    errorDiv.innerHTML = `
                        <h3 style="color: #ff0000; margin-top: 0; margin-bottom: 15px;">âš ï¸ Kakao Maps API ë¡œë“œ ì‹¤íŒ¨ (HTTP 404)</h3>
                        
                        <div style="background: #fff3cd; padding: 12px; border-radius: 4px; margin-bottom: 15px; border-left: 4px solid #ffc107;">
                            <strong style="color: #856404;">âš ï¸ ì¤‘ìš”:</strong> HTTP 404 ì˜¤ë¥˜ëŠ” <strong>í”Œë«í¼ ë¯¸ë“±ë¡</strong>ì´ ê°€ì¥ í”í•œ ì›ì¸ì…ë‹ˆë‹¤.
                        </div>
                        
                        <p style="margin-bottom: 10px;"><strong>ğŸ“‹ í”Œë«í¼ ë“±ë¡ í•„ìˆ˜ ë‹¨ê³„:</strong></p>
                        <ol style="text-align: left; line-height: 2; margin-bottom: 15px; padding-left: 25px;">
                            <li><a href="https://developers.kakao.com" target="_blank" style="color: #007bff; text-decoration: none; font-weight: bold;">Kakao Developers</a> ì ‘ì† (ìƒˆ íƒ­ì—ì„œ ì—´ë¦¼)</li>
                            <li><strong>ë¡œê·¸ì¸</strong> í›„ <strong>"ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜"</strong> ë©”ë‰´ í´ë¦­</li>
                            <li>ì• í”Œë¦¬ì¼€ì´ì…˜ ì„ íƒ (ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±)</li>
                            <li><strong>"í”Œë«í¼"</strong> íƒ­ í´ë¦­ â†’ <strong>"Web í”Œë«í¼"</strong> ë“±ë¡</li>
                            <li><strong>ì‚¬ì´íŠ¸ ë„ë©”ì¸</strong> ì…ë ¥: <code style="background: #f0f0f0; padding: 3px 8px; border-radius: 3px; font-weight: bold; color: #d63384;" id="kakao-domain-placeholder">${window.location.origin}</code></li>
                            <li><strong>ì €ì¥</strong> ë²„íŠ¼ í´ë¦­</li>
                            <li><strong>5-10ë¶„ ëŒ€ê¸°</strong> í›„ ì´ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (F5)</li>
                        </ol>
                        
                        <div style="background: #d1ecf1; padding: 12px; border-radius: 4px; margin-bottom: 15px; border-left: 4px solid #0c5460;">
                            <strong style="color: #0c5460;">ğŸ’¡ í™•ì¸ ì‚¬í•­:</strong>
                            <ul style="margin: 5px 0 0 20px; line-height: 1.8;">
                                <li>JavaScript í‚¤ ì‚¬ìš© ì¤‘ì¸ì§€ í™•ì¸ (REST API í‚¤ ì•„ë‹˜)</li>
                                <li>í˜„ì¬ í‚¤: <code style="background: #f0f0f0; padding: 2px 6px;">6357c5a889634b07801febf524487150</code></li>
                                <li>ë„ë©”ì¸ì€ ì •í™•íˆ <code>${window.location.origin}</code> (í”„ë¡œí† ì½œ, ë„ë©”ì¸, í¬íŠ¸ í¬í•¨)</li>
                            </ul>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 4px; font-size: 12px; margin-bottom: 15px;">
                            <strong>ğŸ” ë””ë²„ê¹…:</strong> F12 â†’ Network íƒ­ â†’ <code>dapi.kakao.com/v2/maps/sdk.js</code> ìš”ì²­ í´ë¦­<br>
                            â†’ Headers íƒ­ì—ì„œ ì‹¤ì œ HTTP ìƒíƒœ ì½”ë“œ í™•ì¸ (404 = í”Œë«í¼ ë¯¸ë“±ë¡)
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button onclick="window.open('https://developers.kakao.com', '_blank')" style="flex: 1; padding: 10px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">Kakao Developers ì—´ê¸°</button>
                            <button onclick="location.reload()" style="flex: 1; padding: 10px 16px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">ìƒˆë¡œê³ ì¹¨</button>
                            <button onclick="this.parentElement.parentElement.remove()" style="flex: 0; padding: 10px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">ë‹«ê¸°</button>
                        </div>
                    `;
                    document.body.appendChild(errorDiv);
                }
            };
            
            script.onload = function() {
                console.log('âœ… Kakao Maps API ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì„±ê³µ');
                // autoload=falseë¥¼ ì‚¬ìš©í–ˆìœ¼ë¯€ë¡œ ìˆ˜ë™ìœ¼ë¡œ ë¡œë“œ
                if (typeof kakao !== 'undefined' && kakao.maps && kakao.maps.load) {
                    console.log('â³ services ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì¤‘...');
                    kakao.maps.load(() => {
                        console.log('âœ… services ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì™„ë£Œ');
                        window.dispatchEvent(new Event('kakao-maps-loaded'));
                    });
                } else {
                    window.dispatchEvent(new Event('kakao-maps-loaded'));
                }
            };
            
            document.head.appendChild(script);
        })();
    </script>
    
    <script>
        // API ê¸°ë³¸ URL
        const API_BASE_URL = '/api';

        // ì „ì—­ ë³€ìˆ˜
        let map = null;
        let markers = []; // ê°€ê²Œ ë§ˆì»¤ë“¤
        let searchMarker = null; // ê²€ìƒ‰ ìœ„ì¹˜ ë§ˆì»¤
        let stores = [];
        let editingStoreId = null;
        let selectedCategory = 'all'; // ì„ íƒëœ ì¹´í…Œê³ ë¦¬

        // Kakao Maps ì§€ë„ ì´ˆê¸°í™” (Wizard ìŠ¤íƒ€ì¼)
        async function initMap() {
            try {
                // Kakao Maps API ë¡œë“œ ëŒ€ê¸°
                const isLoaded = await waitForKakaoMap(5000);
                if (!isLoaded) {
                    showError('Kakao Maps APIë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í”Œë«í¼ ë“±ë¡ì„ í™•ì¸í•˜ì„¸ìš”.');
                    return;
                }

                // ì§€ë„ë¥¼ í‘œì‹œí•  div ìš”ì†Œ
                const mapContainer = document.getElementById('map');
                
                // ì§€ë„ ì˜µì…˜ ì„¤ì • (Wizard ìŠ¤íƒ€ì¼)
                const mapOption = {
                    center: new kakao.maps.LatLng(37.5665, 126.9780), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ (ì„œìš¸ì‹œì²­)
                    level: 3, // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
                    // ì§€ë„ ì˜µì…˜
                    draggable: true, // ë§ˆìš°ìŠ¤ ë“œë˜ê·¸ë¡œ ì§€ë„ ì´ë™ í—ˆìš©
                    scrollwheel: true, // ë§ˆìš°ìŠ¤ íœ ë¡œ ì§€ë„ í™•ëŒ€/ì¶•ì†Œ í—ˆìš©
                    disableDoubleClick: false, // ë”ë¸”í´ë¦­ í™•ëŒ€ í—ˆìš©
                    disableDoubleClickZoom: false // ë”ë¸”í´ë¦­ í™•ëŒ€ ë¹„í™œì„±í™” ì—¬ë¶€
                };
                
                // ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
                map = new kakao.maps.Map(mapContainer, mapOption);
                
                // ì§€ë„ íƒ€ì… ì»¨íŠ¸ë¡¤ì„ ìƒì„±í•©ë‹ˆë‹¤ (ì¼ë°˜ì§€ë„/ìŠ¤ì¹´ì´ë·°/ì§€í˜•ë„)
                const mapTypeControl = new kakao.maps.MapTypeControl();
                map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);
                
                // í™•ëŒ€ ì¶•ì†Œ ì»¨íŠ¸ë¡¤ì„ ìƒì„±í•©ë‹ˆë‹¤
                const zoomControl = new kakao.maps.ZoomControl();
                map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);
                
                // ì§€ë„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (Wizard ìŠ¤íƒ€ì¼)
                
                // ì§€ë„ ì¤‘ì‹¬ ì¢Œí‘œ ë³€í™” ì´ë²¤íŠ¸
                kakao.maps.event.addListener(map, 'center_changed', function() {
                    const center = map.getCenter();
                    console.log('ì§€ë„ ì¤‘ì‹¬ ì¢Œí‘œ:', center.getLat(), center.getLng());
                });
                
                // ì§€ë„ í™•ëŒ€/ì¶•ì†Œ ì´ë²¤íŠ¸
                kakao.maps.event.addListener(map, 'zoom_changed', function() {
                    const level = map.getLevel();
                    console.log('ì§€ë„ í™•ëŒ€/ì¶•ì†Œ ë ˆë²¨:', level);
                });
                
                // ì§€ë„ ì˜ì—­ ë³€í™” ì´ë²¤íŠ¸
                kakao.maps.event.addListener(map, 'bounds_changed', function() {
                    const bounds = map.getBounds();
                    const sw = bounds.getSouthWest();
                    const ne = bounds.getNorthEast();
                    console.log('ì§€ë„ ì˜ì—­:', sw.getLat(), sw.getLng(), '~', ne.getLat(), ne.getLng());
                });
                
                // ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸ - ì£¼ì†Œ ê²€ìƒ‰ì— ì‚¬ìš©
                kakao.maps.event.addListener(map, 'click', async function(mouseEvent) {
                    const latlng = mouseEvent.latLng;
                    const latInput = document.getElementById('storeLatitude');
                    const lngInput = document.getElementById('storeLongitude');
                    const roadAddressInput = document.getElementById('storeRoadAddress');
                    
                    console.log('ì§€ë„ í´ë¦­ ì¢Œí‘œ:', latlng.getLat(), latlng.getLng());
                    
                    if (latInput && lngInput) {
                        latInput.value = latlng.getLat().toFixed(6);
                        lngInput.value = latlng.getLng().toFixed(6);
                        
                        // ëª¨ë‹¬ì´ ì—´ë ¤ìˆìœ¼ë©´ ì—­ì§€ì˜¤ì½”ë”©ìœ¼ë¡œ ì£¼ì†Œ ìë™ ì…ë ¥
                        if (document.getElementById('storeModal').classList.contains('active')) {
                            try {
                                const koreanAddress = await reverseGeocode(latlng.getLat(), latlng.getLng());
                                if (koreanAddress && roadAddressInput) {
                                    roadAddressInput.value = koreanAddress;
                                }
                            } catch (error) {
                                console.error('ì§€ë„ í´ë¦­ ì£¼ì†Œ ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:', error);
                            }
                        }
                    }
                });
                
                // ì§€ë„ ë“œë˜ê·¸ ì´ë²¤íŠ¸
                kakao.maps.event.addListener(map, 'dragstart', function() {
                    console.log('ì§€ë„ ë“œë˜ê·¸ ì‹œì‘');
                });
                
                kakao.maps.event.addListener(map, 'dragend', function() {
                    console.log('ì§€ë„ ë“œë˜ê·¸ ì¢…ë£Œ');
                });
                
                console.log('âœ… Kakao Maps ì§€ë„ ì´ˆê¸°í™” ì™„ë£Œ (Wizard ìŠ¤íƒ€ì¼)');
            } catch (error) {
                console.error('ì§€ë„ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                showError('ì§€ë„ë¥¼ ì´ˆê¸°í™”í•˜ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ëª¨ë“  ê°€ê²Œ ë¡œë“œ
        async function loadStores() {
            try {
                showLoading(true);
                const response = await fetch(`${API_BASE_URL}/stores`);
                const result = await response.json();
                
                if (result.success) {
                    stores = result.data;
                    updateCategoryFilters(stores);
                    filterAndDisplayStores();
                } else {
                    showError('ê°€ê²Œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Error loading stores:', error);
                showError('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.');
            } finally {
                showLoading(false);
            }
        }

        // PiStore ì¹´í…Œê³ ë¦¬ ëª©ë¡ (https://www.pistore.info/sub01_01.html ì°¸ê³ )
        const pistoreCategories = [
            'PC, ë…¸íŠ¸ë¶ , ê²Œì„',
            'ê°€ì „, íœ´ëŒ€í°',
            'íŒ¨ì…˜ , ì¡í™”',
            'í”¼ë¶€,í—¤ì–´, ë¯¸ìš©, í™”ì¥í’ˆ',
            'ê±´ì„¤, ì¸í…Œë¦¬ì–´, ë¶€ë™ì‚°',
            'ì™¸ì‹ì—…, ê¹Œí˜',
            'ìë™ì°¨ ê´€ë ¨',
            'ì—¬í–‰ , ë ˆì ¸ , ë„ì„œ',
            'ìˆ™ë°•',
            'ê¸°íƒ€',
            'ì˜ë£Œê´€ë ¨',
            'ë²•ë¥ í–‰ì • ì„œë¹„ìŠ¤',
            'ì‚¬ì£¼, ìš´ì„¸, ì‘ëª…, íƒ€ë¡œ',
            'ìŠ¤í¬ì¸  , ì·¨ë¯¸, ê±´ê°•',
            'ì‹í’ˆ, ê±´ê°•ì‹í’ˆë“±',
            'ì‚¬ë¬´ê¸°ê¸°',
            'ì œì¡°',
            'ë°˜ë ¤ê²¬,ë¬˜ ê´€ë ¨',
            'êµìœ¡'
        ];

        // ì¹´í…Œê³ ë¦¬ í•„í„° í† ê¸€
        function toggleCategoryFilter() {
            const container = document.getElementById('categoryFilterContainer');
            const icon = document.getElementById('categoryToggleIcon');
            const isVisible = container.style.display !== 'none';
            
            if (isVisible) {
                container.style.display = 'none';
                icon.textContent = 'â–¶';
                icon.style.transform = 'rotate(0deg)';
                } else {
                container.style.display = 'block';
                icon.textContent = 'â–¼';
                icon.style.transform = 'rotate(0deg)';
            }
        }

        // ì¹´í…Œê³ ë¦¬ í•„í„° ì—…ë°ì´íŠ¸ (PiStore ìŠ¤íƒ€ì¼ - ì „ì²´ ì¹´í…Œê³ ë¦¬ í‘œì‹œ)
        function updateCategoryFilters(storeList) {
            const categoryFilterContainer = document.getElementById('categoryFilterContainer');
            
            // PiStore ì¹´í…Œê³ ë¦¬ ëª©ë¡ì„ ì‚¬ìš©í•˜ì—¬ ë²„íŠ¼ ìƒì„± (ë§¤ì¥ ìˆ˜ í¬í•¨)
            // ì‹¤ì œ ë§¤ì¥ì´ ì—†ëŠ” ì¹´í…Œê³ ë¦¬ë„ í‘œì‹œí•˜ë˜, ë§¤ì¥ ìˆ˜ê°€ 0ì¸ ê²½ìš°ë„ í‘œì‹œ
            const categoryButtons = pistoreCategories.map(category => {
                const actualCount = storeList.filter(store => store.category === category).length;
                const isActive = selectedCategory === category;
                
                // ëª¨ë“  ì¹´í…Œê³ ë¦¬ë¥¼ í‘œì‹œ (ë§¤ì¥ ìˆ˜ì™€ í•¨ê»˜)
                return `<button class="category-filter-btn ${isActive ? 'active' : ''}" data-category="${escapeHtml(category)}" onclick="filterByCategory('${escapeHtml(category)}')">${escapeHtml(category)} (${actualCount})</button>`;
            }).join('');
            
            // ì „ì²´ë³´ê¸° ë²„íŠ¼ê³¼ ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ë“¤ ì¶”ê°€
            const allCount = storeList.length;
            categoryFilterContainer.innerHTML = `
                <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                    <span style="color: white; font-weight: 600; font-size: 0.9rem;">ì¹´í…Œê³ ë¦¬:</span>
                    <button class="category-filter-btn ${selectedCategory === 'all' ? 'active' : ''}" data-category="all" onclick="filterByCategory('all')">ì „ì²´ë³´ê¸° (${allCount})</button>
                    ${categoryButtons}
                </div>
            `;
        }

        // ì¹´í…Œê³ ë¦¬ë³„ í•„í„°ë§ ë° í‘œì‹œ
        function filterAndDisplayStores() {
            let filteredStores = stores;
            
            if (selectedCategory !== 'all') {
                filteredStores = stores.filter(store => store.category === selectedCategory);
            }
            
            displayStores(filteredStores);
            // ì„ íƒëœ ì¹´í…Œê³ ë¦¬ì— í•´ë‹¹í•˜ëŠ” ê°€ê²Œë§Œ ë³´ë¼ìƒ‰ ë§ˆì»¤ë¡œ í‘œì‹œ
            displayStoreMarkers(filteredStores);
            document.getElementById('storeCount').textContent = filteredStores.length;
        }

        // ì¹´í…Œê³ ë¦¬ í•„í„° ë³€ê²½
        function filterByCategory(category) {
            selectedCategory = category;
            
            // ëª¨ë“  ë²„íŠ¼ì˜ active í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.category-filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ì„ íƒëœ ë²„íŠ¼ì— active í´ë˜ìŠ¤ ì¶”ê°€
            document.querySelectorAll(`.category-filter-btn[data-category="${category}"]`).forEach(btn => {
                btn.classList.add('active');
            });
            
            filterAndDisplayStores();
        }

        // ê°€ê²Œ ëª©ë¡ í‘œì‹œ
        function displayStores(storeList) {
            const storeListContent = document.getElementById('storeListContent');
            
            if (storeList.length === 0) {
                storeListContent.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: #aaa;">
                        ë“±ë¡ëœ ê°€ê²Œê°€ ì—†ìŠµë‹ˆë‹¤.<br>
                        "+ ê°€ê²Œ ì¶”ê°€" ë²„íŠ¼ì„ ëˆŒëŸ¬ ê°€ê²Œë¥¼ ì¶”ê°€í•˜ì„¸ìš”.
                    </div>
                `;
                return;
            }

            storeListContent.innerHTML = storeList.map(store => {
                // adminì´ê±°ë‚˜ ë³¸ì¸ ê°€ê²Œì¸ ê²½ìš°ì—ë§Œ ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ í‘œì‹œ
                const canEdit = currentUser && (currentUser.username === 'admin' || store.user_id === currentUser.id);
                
                return `
                <div class="store-item" onclick="focusStore(${store.latitude}, ${store.longitude}, '${store.name.replace(/'/g, "\\'")}')">
                    ${canEdit ? `
                    <div class="store-item-actions" onclick="event.stopPropagation()">
                        <button class="store-item-btn edit-btn" onclick="event.stopPropagation(); openUserInfoModal()">ìˆ˜ì •</button>
                        <button class="store-item-btn delete-btn" onclick="event.stopPropagation(); deleteStore(${store.id})">ì‚­ì œ</button>
                    </div>
                    ` : ''}
                    <h3>${escapeHtml(store.name)}</h3>
                    ${store.road_address ? `<p>ğŸ“ ë„ë¡œëª…: ${escapeHtml(store.road_address)}</p>` : ''}
                    ${store.lot_address ? `<p>ğŸ“ ì§€ë²ˆ: ${escapeHtml(store.lot_address)}</p>` : ''}
                    ${!store.road_address && !store.lot_address ? `<p>ğŸ“ ${escapeHtml(store.address)}</p>` : ''}
                    ${store.phone ? `<p>ğŸ“ ${escapeHtml(store.phone)}</p>` : ''}
                    ${store.category ? `<p style="font-size: 0.8rem; color: #888;">ì¹´í…Œê³ ë¦¬: ${escapeHtml(store.category)}</p>` : ''}
                    ${store.description ? `<p style="font-size: 0.8rem; color: #888;">${escapeHtml(store.description)}</p>` : ''}
                </div>
            `;
            }).join('');
        }

        // ê°€ê²Œ ë§ˆì»¤ í‘œì‹œ (Wizard ìŠ¤íƒ€ì¼)
        function displayStoreMarkers(storeList) {
            if (!map || typeof kakao === 'undefined' || !kakao.maps) {
                console.warn('Kakao Mapsê°€ ë¡œë“œë˜ì§€ ì•Šì•„ ë§ˆì»¤ë¥¼ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ê¸°ì¡´ ê°€ê²Œ ë§ˆì»¤ë§Œ ì œê±° (ê²€ìƒ‰ ë§ˆì»¤ëŠ” ìœ ì§€)
            clearMarkers();

            const bounds = new kakao.maps.LatLngBounds();

            storeList.forEach(store => {
                // ë§ˆì»¤ê°€ í‘œì‹œë  ìœ„ì¹˜ì…ë‹ˆë‹¤
                const markerPosition = new kakao.maps.LatLng(store.latitude, store.longitude);
                
                // ì»¤ìŠ¤í…€ ë§ˆì»¤ ì´ë¯¸ì§€ ìƒì„± (ë³´ë¼ìƒ‰ ì›)
                const imageSrc = 'data:image/svg+xml;base64,' + btoa(`
                    <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="10" fill="#9b59b6" stroke="#ffffff" stroke-width="2"/>
                    </svg>
                `);
                
                // ë§ˆì»¤ ì´ë¯¸ì§€ì˜ í¬ê¸°ì…ë‹ˆë‹¤
                const imageSize = new kakao.maps.Size(24, 24);
                
                // ë§ˆì»¤ ì´ë¯¸ì§€ì˜ ì˜µì…˜ì…ë‹ˆë‹¤. ë§ˆì»¤ì˜ ì¢Œí‘œì™€ ì¼ì¹˜ì‹œí‚¬ ì´ë¯¸ì§€ ë‚´ì—ì„œì˜ ì¢Œí‘œë¥¼ ì„¤ì •í•©ë‹ˆë‹¤
                const imageOption = { 
                    offset: new kakao.maps.Point(12, 12) // ë§ˆì»¤ ì´ë¯¸ì§€ì—ì„œ ê¸°ì¤€ì (ì¢Œìƒë‹¨)ì˜ ìœ„ì¹˜
                };
                
                // ë§ˆì»¤ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
                const markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption);
                
                // ë§ˆì»¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
            const marker = new kakao.maps.Marker({
                    position: markerPosition,
                    image: markerImage
                });
                
                // ë§ˆì»¤ê°€ ì§€ë„ ìœ„ì— í‘œì‹œë˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤
                marker.setMap(map);
                
                // ì¸í¬ìœˆë„ìš°ì— í‘œì‹œí•  ë‚´ìš©ì…ë‹ˆë‹¤
                const iwContent = `
                    <div style="padding: 10px; min-width: 200px; max-width: 300px;">
                        <h3 style="margin: 0 0 8px 0; font-size: 15px; font-weight: bold; color: #333; border-bottom: 2px solid #9b59b6; padding-bottom: 5px;">${escapeHtml(store.name)}</h3>
                        ${store.road_address ? `<p style="margin: 5px 0; font-size: 12px; color: #666;">ğŸ“ ë„ë¡œëª…: ${escapeHtml(store.road_address)}</p>` : ''}
                        ${store.lot_address ? `<p style="margin: 5px 0; font-size: 12px; color: #666;">ğŸ“ ì§€ë²ˆ: ${escapeHtml(store.lot_address)}</p>` : ''}
                        ${!store.road_address && !store.lot_address ? `<p style="margin: 5px 0; font-size: 12px; color: #666;">ğŸ“ ${escapeHtml(store.address)}</p>` : ''}
                        ${store.phone ? `<p style="margin: 5px 0; font-size: 12px; color: #666;">ğŸ“ ${escapeHtml(store.phone)}</p>` : ''}
                        ${store.email ? `<p style="margin: 5px 0; font-size: 12px; color: #666;">ğŸ“§ ${escapeHtml(store.email)}</p>` : ''}
                        ${store.category ? `<p style="margin: 5px 0; font-size: 11px; color: #888; background: #f0f0f0; padding: 3px 8px; border-radius: 4px; display: inline-block;">${escapeHtml(store.category)}</p>` : ''}
                        ${store.description ? `<div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee;"><p style="margin: 0; font-size: 12px; color: #555; line-height: 1.5; white-space: pre-wrap;">${escapeHtml(store.description)}</p></div>` : ''}
                    </div>
                `;

                // ì¸í¬ìœˆë„ìš°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
            const infowindow = new kakao.maps.InfoWindow({
                    content: iwContent
            });

                // ë§ˆì»¤ ì´ë²¤íŠ¸ (Wizard ìŠ¤íƒ€ì¼)
                
                // ë§ˆì»¤ì— ë§ˆìš°ìŠ¤ì˜¤ë²„ ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
                kakao.maps.event.addListener(marker, 'mouseover', function() {
            infowindow.open(map, marker);
                });
                
                // ë§ˆì»¤ì— ë§ˆìš°ìŠ¤ì•„ì›ƒ ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
                kakao.maps.event.addListener(marker, 'mouseout', function() {
                    infowindow.close();
                });

                // ë§ˆì»¤ í´ë¦­ ì´ë²¤íŠ¸ - ì„¤ëª… í¬í•¨ ì¸í¬ìœˆë„ìš° í‘œì‹œ
                kakao.maps.event.addListener(marker, 'click', function() {
                    // ë§ˆì»¤ í´ë¦­ ì‹œ ì§€ë„ ì¤‘ì‹¬ì„ ì´ë™í•©ë‹ˆë‹¤
                    map.setCenter(markerPosition);
                    map.setLevel(3);
                    // ì¸í¬ìœˆë„ìš° ì—´ê¸° (ì„¤ëª… í¬í•¨)
                    infowindow.open(map, marker);
                });

                markers.push({ marker: marker, infowindow: infowindow });
                bounds.extend(markerPosition);
            });

            // ê²€ìƒ‰ ë§ˆì»¤ë„ í¬í•¨í•˜ì—¬ ì§€ë„ ë²”ìœ„ ì¡°ì •
            if (searchMarker && searchMarker.getPosition) {
                bounds.extend(searchMarker.getPosition());
            }

            // ëª¨ë“  ë§ˆì»¤ê°€ ë³´ì´ë„ë¡ ì§€ë„ ë²”ìœ„ ì¡°ì •
            if (storeList.length > 0) {
                map.setBounds(bounds);
            }
        }

        // í•œì ì œê±° ë° í•œêµ­ì–´ ì£¼ì†Œë§Œ ì¶”ì¶œ
        function cleanKoreanAddress(address) {
            if (!address) return '';
            
            // í•œì ë²”ìœ„: \u4e00-\u9fff
            // í•œìë¥¼ ì œê±°í•˜ê³ , í•œêµ­ì–´(í•œê¸€, ì˜ë¬¸, ìˆ«ì, ê³µë°±, íŠ¹ìˆ˜ë¬¸ì)ë§Œ ë‚¨ê¹€
            let cleaned = address.replace(/[\u4e00-\u9fff]/g, '');
            
            // ê´„í˜¸ ì•ˆì˜ í•œì ì œê±° (ì˜ˆ: "ì„œìš¸(ì„œìš¸)" -> "ì„œìš¸")
            cleaned = cleaned.replace(/\([^)]*[\u4e00-\u9fff][^)]*\)/g, '');
            
            // ì—°ì†ëœ ê³µë°± ì œê±°
            cleaned = cleaned.replace(/\s+/g, ' ').trim();
            
            // ì‰¼í‘œë‚˜ ìŠ¬ë˜ì‹œë¡œ ë¶„ë¦¬ëœ ê²½ìš° ì²« ë²ˆì§¸ í•œêµ­ì–´ ì£¼ì†Œë§Œ ì‚¬ìš©
            const parts = cleaned.split(/[,\/]/);
            for (let part of parts) {
                part = part.trim();
                // í•œê¸€ì´ í¬í•¨ëœ ë¶€ë¶„ ì°¾ê¸°
                if (/[ê°€-í£]/.test(part)) {
                    return part;
                }
            }
            
            return cleaned || address;
        }

        // ì—­ì§€ì˜¤ì½”ë”© - ìœ„ë„/ê²½ë„ì—ì„œ í•œêµ­ì–´ ì£¼ì†Œ ê°€ì ¸ì˜¤ê¸° (Kakao Maps SDK ì‚¬ìš©)
        async function reverseGeocode(lat, lng) {
            return new Promise((resolve) => {
                try {
                    // Kakao Maps API ë¡œë“œ ëŒ€ê¸°
                    waitForKakaoMap(5000).then((isLoaded) => {
                        if (!isLoaded || typeof kakao === 'undefined' || !kakao.maps || !kakao.maps.services) {
                            console.warn('Kakao Maps APIê°€ ë¡œë“œë˜ì§€ ì•Šì•„ ì—­ì§€ì˜¤ì½”ë”©ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                            resolve('');
                            return;
                        }

                        const geocoder = new kakao.maps.services.Geocoder();
                        
                        // ì¢Œí‘œë¥¼ ì£¼ì†Œë¡œ ë³€í™˜
                        geocoder.coord2Address(lng, lat, function(result, status) {
                            if (status === kakao.maps.services.Status.OK) {
                                if (result && result.length > 0) {
                                    const item = result[0];
                                    // ë„ë¡œëª… ì£¼ì†Œ ìš°ì„ , ì—†ìœ¼ë©´ ì§€ë²ˆ ì£¼ì†Œ
                                    const address = item.road_address 
                                        ? item.road_address.address_name 
                                        : (item.address ? item.address.address_name : '');
                                    resolve(address);
                } else {
                                    resolve('');
                                }
                            } else {
                                console.warn('Kakao ì—­ì§€ì˜¤ì½”ë”© ì‹¤íŒ¨:', status);
                                resolve('');
                            }
                        });
                    });
                } catch (error) {
                    console.error('ì—­ì§€ì˜¤ì½”ë”© ì˜¤ë¥˜:', error);
                    resolve('');
                }
            });
        }


        // Kakao Maps API ë¡œë“œ ëŒ€ê¸° í•¨ìˆ˜
        async function waitForKakaoMap(maxWait = 20000) {
            return new Promise((resolve) => {
                // ì´ë¯¸ ë¡œë“œë˜ì–´ ìˆìœ¼ë©´ ì¦‰ì‹œ ë°˜í™˜
                if (typeof kakao !== 'undefined' && kakao.maps && kakao.maps.services) {
                    console.log('âœ… Kakao Maps API ì´ë¯¸ ë¡œë“œë¨');
                    resolve(true);
                    return;
                }

                console.log('â³ Kakao Maps API ë¡œë“œ ëŒ€ê¸° ì¤‘... (ìµœëŒ€ ' + maxWait/1000 + 'ì´ˆ)');
                
                // ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
                const onLoad = () => {
                    if (typeof kakao !== 'undefined' && kakao.maps && kakao.maps.services) {
                        console.log('âœ… Kakao Maps API ë¡œë“œ ì™„ë£Œ');
                        resolve(true);
                    }
                };
                
                window.addEventListener('kakao-maps-loaded', onLoad);
                
                const startTime = Date.now();
                const checkInterval = 100; // 100msë§ˆë‹¤ í™•ì¸

                const checkKakao = setInterval(() => {
                    // kakao ê°ì²´ ìƒì„¸ í™•ì¸
                    if (typeof kakao !== 'undefined') {
                        if (kakao.maps) {
                            // servicesê°€ ì—†ìœ¼ë©´ ë™ì ìœ¼ë¡œ ë¡œë“œ ì‹œë„
                            if (!kakao.maps.services && kakao.maps.load) {
                                if (Date.now() - startTime > 2000 && !window.servicesLoading) {
                                    // í•œ ë²ˆë§Œ ì‹¤í–‰
                                    window.servicesLoading = true;
                                    console.log('â³ services ë¼ì´ë¸ŒëŸ¬ë¦¬ ë™ì  ë¡œë“œ ì‹œë„...');
                                    kakao.maps.load(() => {
                                        console.log('âœ… services ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì™„ë£Œ');
                                        if (kakao.maps.services) {
                                            clearInterval(checkKakao);
                                            window.removeEventListener('kakao-maps-loaded', onLoad);
                                            resolve(true);
                                            return;
                                        }
                                    });
                                }
                            }
                            
                            if (kakao.maps.services) {
                                clearInterval(checkKakao);
                                window.removeEventListener('kakao-maps-loaded', onLoad);
                                console.log('âœ… Kakao Maps API ë¡œë“œ ì™„ë£Œ');
                                resolve(true);
                                return;
                            }
                        }
                    }
                    
                    if (Date.now() - startTime >= maxWait) {
                        clearInterval(checkKakao);
                        window.removeEventListener('kakao-maps-loaded', onLoad);
                        console.error('âŒ Kakao Maps API ë¡œë“œ íƒ€ì„ì•„ì›ƒ');
                        console.error('');
                        console.error('ğŸ” HTTP 404 ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤ë©´:');
                        console.error('   â†’ í”Œë«í¼ ë¯¸ë“±ë¡ ë˜ëŠ” API í‚¤ ë¬¸ì œ (ê°€ì¥ í”í•œ ì›ì¸)');
                        console.error('');
                        console.error('âœ… í•´ê²° ë°©ë²•:');
                        console.error('1. https://developers.kakao.com ì ‘ì†');
                        console.error('2. ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„ íƒ');
                        console.error('3. í”Œë«í¼ ì„¤ì • â†’ Web í”Œë«í¼ ë“±ë¡');
                        console.error(`4. ì‚¬ì´íŠ¸ ë„ë©”ì¸ ë“±ë¡: ${window.location.origin}`);
                        console.error('5. JavaScript í‚¤ í™•ì¸: 6357c5a889634b07801febf524487150');
                        console.error('6. ë“±ë¡ í›„ 5-10ë¶„ ëŒ€ê¸° í›„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨');
                        console.error('');
                        console.error('ğŸ’¡ F12 â†’ Network íƒ­ì—ì„œ ì‹¤ì œ HTTP ìƒíƒœ ì½”ë“œ í™•ì¸');
                        resolve(false);
                    }
                }, checkInterval);
            });
        }

        // Kakao Maps Geocoding APIë¡œ ì£¼ì†Œ ê²€ìƒ‰ (í•œêµ­ ì£¼ì†Œ ê²€ìƒ‰ì— ìµœì í™”)
        async function searchAddressWithKakao(address) {
            return new Promise(async (resolve, reject) => {
                try {
                    // Kakao Maps API ë¡œë“œ ëŒ€ê¸°
                    const isLoaded = await waitForKakaoMap(5000);
                    if (!isLoaded) {
                        console.warn('Kakao Maps APIê°€ ë¡œë“œë˜ì§€ ì•ŠìŒ');
                        resolve(null);
                        return;
                    }

                    // Kakao Maps APIê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ ë‹¤ì‹œ í™•ì¸
                    if (typeof kakao === 'undefined' || !kakao.maps || !kakao.maps.services) {
                        console.warn('Kakao Maps APIê°€ ë¡œë“œë˜ì§€ ì•ŠìŒ');
                        resolve(null);
                        return;
                    }

                    const geocoder = new kakao.maps.services.Geocoder();
                    
                    console.log('Kakao Geocoding ê²€ìƒ‰ ì‹œë„:', address);
                    
                    // ì£¼ì†Œ ê²€ìƒ‰
                    geocoder.addressSearch(address, function(result, status) {
                        if (status === kakao.maps.services.Status.OK) {
                            if (result && result.length > 0) {
                                const item = result[0];
                                const lat = parseFloat(item.y);
                                const lng = parseFloat(item.x);
                                
                                console.log('Kakao Geocoding ê²€ìƒ‰ ì„±ê³µ:', { lat, lng, address: item.address_name });
                                
                                // ë„ë¡œëª… ì£¼ì†Œì™€ ì§€ë²ˆ ì£¼ì†Œ êµ¬ë¶„
                                const roadAddress = item.road_address ? item.road_address.address_name : '';
                                const jibunAddress = item.address ? item.address.address_name : '';
                                
                                resolve({
                                    lat: lat,
                                    lng: lng,
                                    roadAddress: roadAddress,
                                    jibunAddress: jibunAddress,
                                    displayAddress: roadAddress || jibunAddress || item.address_name,
                                    title: item.address_name
                                });
                        } else {
                                console.log('Kakao Geocoding ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ');
                                resolve(null);
                            }
                        } else {
                            console.log('Kakao Geocoding ê²€ìƒ‰ ì‹¤íŒ¨:', status);
                            resolve(null);
                        }
                    });
                } catch (error) {
                    console.error('Kakao Geocoding ì˜¤ë¥˜:', error);
                    resolve(null);
                }
            });
        }

        // ëª¨ë‹¬ì—ì„œ ì£¼ì†Œ ê²€ìƒ‰ (store-finder.htmlìš©)
        async function searchAddressFromModal() {
            const addressInput = document.getElementById('storeAddress');
            const address = addressInput.value.trim();
            
            if (!address) {
                showError('ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ê¸°ì¡´ searchAddress í•¨ìˆ˜ ì‚¬ìš© (ì§€ë„ì—ë„ í‘œì‹œ)
            await searchAddress(address);
        }

        // ì£¼ì†Œ ê²€ìƒ‰ (Geocoding) - Kakao Maps SDKë§Œ ì‚¬ìš©
        async function searchAddress(address) {
            if (!map || typeof kakao === 'undefined' || !kakao.maps) {
                showError('ì§€ë„ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                return;
            }

            showLoading(true);
            hideError();

            try {
                // Kakao Maps Geocoding API ì‚¬ìš©
                const kakaoResult = await searchAddressWithKakao(address);
                if (!kakaoResult || !kakaoResult.lat || !kakaoResult.lng) {
                    showLoading(false);
                    showError('ì£¼ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì§€ë„ë¥¼ í´ë¦­í•˜ì—¬ ìœ„ì¹˜ë¥¼ ì§ì ‘ ì§€ì •í•´ì£¼ì„¸ìš”.');
                    return;
                }

                const lat = kakaoResult.lat;
                const lng = kakaoResult.lng;
                const displayAddress = kakaoResult.displayAddress;
                const roadAddress = kakaoResult.roadAddress;
                const jibunAddress = kakaoResult.jibunAddress;

                console.log('Kakao Geocoding ê²€ìƒ‰ ì„±ê³µ:', kakaoResult);
                
                showLoading(false);
                
                // ì´ì „ ê²€ìƒ‰ ë§ˆì»¤ ì œê±°
                if (searchMarker) {
                    searchMarker.setMap(null);
                    searchMarker = null;
                }
                
                // ê²€ìƒ‰ ìœ„ì¹˜ ë§ˆì»¤ê°€ í‘œì‹œë  ìœ„ì¹˜ì…ë‹ˆë‹¤
                const markerPosition = new kakao.maps.LatLng(lat, lng);
                
                // ì»¤ìŠ¤í…€ ë§ˆì»¤ ì´ë¯¸ì§€ ìƒì„± (ë¹¨ê°„ìƒ‰ ì›)
                const imageSrc = 'data:image/svg+xml;base64,' + btoa(`
                    <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="10" fill="#ff0000" stroke="#ffffff" stroke-width="3"/>
                    </svg>
                `);
                
                // ë§ˆì»¤ ì´ë¯¸ì§€ì˜ í¬ê¸°ì…ë‹ˆë‹¤
                const imageSize = new kakao.maps.Size(24, 24);
                
                // ë§ˆì»¤ ì´ë¯¸ì§€ì˜ ì˜µì…˜ì…ë‹ˆë‹¤. ë§ˆì»¤ì˜ ì¢Œí‘œì™€ ì¼ì¹˜ì‹œí‚¬ ì´ë¯¸ì§€ ë‚´ì—ì„œì˜ ì¢Œí‘œë¥¼ ì„¤ì •í•©ë‹ˆë‹¤
                const imageOption = { 
                    offset: new kakao.maps.Point(12, 12) // ë§ˆì»¤ ì´ë¯¸ì§€ì—ì„œ ê¸°ì¤€ì (ì¢Œìƒë‹¨)ì˜ ìœ„ì¹˜
                };
                
                // ë§ˆì»¤ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
                const markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption);
                
                // ë§ˆì»¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
                searchMarker = new kakao.maps.Marker({
                    position: markerPosition,
                    image: markerImage
                });
                
                // ë§ˆì»¤ê°€ ì§€ë„ ìœ„ì— í‘œì‹œë˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤
                searchMarker.setMap(map);
                
                // ì¸í¬ìœˆë„ìš°ì— í‘œì‹œí•  ë‚´ìš©ì…ë‹ˆë‹¤
                // ê°€ê²Œ ì´ë¦„ ê°€ì ¸ì˜¤ê¸° (ëª¨ë‹¬ì´ ì—´ë ¤ìˆì„ ê²½ìš°)
                const storeNameInput = document.getElementById('storeName');
                const storeName = storeNameInput ? storeNameInput.value.trim() : '';
                const displayTitle = storeName || 'ê²€ìƒ‰ ìœ„ì¹˜';
                
                const iwContent = `
                    <div style="padding: 8px; min-width: 200px; text-align: center;">
                        <div style="font-weight: bold; color: #ff0000; margin-bottom: 5px;">ğŸ“ ${escapeHtml(displayTitle)}</div>
                        <div style="font-size: 12px; color: #666;">${escapeHtml(displayAddress)}</div>
                        ${roadAddress && roadAddress !== displayAddress ? `<div style="font-size: 11px; color: #888; margin-top: 3px;">ë„ë¡œëª…: ${escapeHtml(roadAddress)}</div>` : ''}
                        ${jibunAddress && jibunAddress !== displayAddress && jibunAddress !== roadAddress ? `<div style="font-size: 11px; color: #888; margin-top: 3px;">ì§€ë²ˆ: ${escapeHtml(jibunAddress)}</div>` : ''}
                    </div>
                `;

                // ì¸í¬ìœˆë„ìš°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
                const infowindow = new kakao.maps.InfoWindow({
                    content: iwContent
                });
                
                // ì¸í¬ìœˆë„ìš°ë¥¼ ë§ˆì»¤ ìœ„ì— í‘œì‹œí•©ë‹ˆë‹¤
                infowindow.open(map, searchMarker);
                
                // ì§€ë„ ì¤‘ì‹¬ì„ ì´ë™í•©ë‹ˆë‹¤
                map.setCenter(markerPosition);
                map.setLevel(3);
                
                // ëª¨ë‹¬ì´ ì—´ë ¤ìˆìœ¼ë©´ ìœ„ë„/ê²½ë„ ë° ì£¼ì†Œ ìë™ ì…ë ¥
                if (document.getElementById('storeModal').classList.contains('active')) {
                    document.getElementById('storeLatitude').value = lat.toFixed(6);
                    document.getElementById('storeLongitude').value = lng.toFixed(6);
                    
                    const roadAddressInput = document.getElementById('storeRoadAddress');
                    const lotAddressInput = document.getElementById('storeLotAddress');
                    const addressInput = document.getElementById('storeAddress');
                    
                    // ìˆ¨ê²¨ì§„ í•„ë“œì— ë„ë¡œëª…/ì§€ë²ˆ ì£¼ì†Œ ì €ì¥
                    if (roadAddressInput) {
                        roadAddressInput.value = roadAddress || '';
                    }
                    if (lotAddressInput) {
                        lotAddressInput.value = jibunAddress || '';
                    }
                    // ì£¼ì†Œ ì…ë ¥ì¹¸ì— ë„ë¡œëª… ì£¼ì†Œ ìš°ì„  í‘œì‹œ
                    if (addressInput) {
                        addressInput.value = roadAddress || jibunAddress || displayAddress;
                    }
                }
            } catch (error) {
                console.error('ì£¼ì†Œ ê²€ìƒ‰ ì˜¤ë¥˜:', error);
                showLoading(false);
                showError('ì£¼ì†Œ ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. Kakao Maps APIë¥¼ í™•ì¸í•˜ì„¸ìš”.');
            }
        }

        // ê°€ê²Œ ì¶”ê°€ ëª¨ë‹¬ ì—´ê¸° (ì‚¬ìš©í•˜ì§€ ì•ŠìŒ - íšŒì›ê°€ì…ìœ¼ë¡œ ëŒ€ì²´)
        function openAddStoreModal() {
            // íšŒì›ê°€ì… ëª¨ë‹¬ ì—´ê¸°ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
            if (!currentUser) {
                openRegisterModal();
            }
        }

        // ê°€ê²Œ ìˆ˜ì •
        async function editStore(id) {
            try {
                showLoading(true);
                const response = await fetch(`${API_BASE_URL}/stores/${id}`);
                const result = await response.json();
                
                if (result.success) {
                    const store = result.data;
                    editingStoreId = id;
                    document.getElementById('modalTitle').textContent = 'ê°€ê²Œ ìˆ˜ì •';
                    document.getElementById('storeId').value = store.id;
                    document.getElementById('storeName').value = store.name;
                    // ì£¼ì†Œ ì…ë ¥ì¹¸ì—ëŠ” ë„ë¡œëª… ì£¼ì†Œ ìš°ì„ , ì—†ìœ¼ë©´ í‘œì‹œìš© ì£¼ì†Œ
                    document.getElementById('storeAddress').value = store.road_address || store.address || '';
                    // ìˆ¨ê²¨ì§„ í•„ë“œì— ë„ë¡œëª…/ì§€ë²ˆ ì£¼ì†Œ ì €ì¥
                    document.getElementById('storeRoadAddress').value = store.road_address || '';
                    document.getElementById('storeLotAddress').value = store.lot_address || '';
                    document.getElementById('storeLatitude').value = store.latitude;
                    document.getElementById('storeLongitude').value = store.longitude;
                    document.getElementById('storePhone').value = store.phone || '';
                    document.getElementById('storeEmail').value = store.email || '';
                    // ì¹´í…Œê³ ë¦¬ ë“œë¡­ë‹¤ìš´ ì„ íƒ
                    const categorySelect = document.getElementById('storeCategory');
                    if (categorySelect) {
                        categorySelect.value = store.category || '';
                    }
                    document.getElementById('storeDescription').value = store.description || '';
                    document.getElementById('storeModal').classList.add('active');
                    
                    // í•´ë‹¹ ìœ„ì¹˜ë¡œ ì§€ë„ ì´ë™
                    if (map) {
                        const position = new kakao.maps.LatLng(store.latitude, store.longitude);
                        map.setCenter(position);
                        map.setLevel(3);
                    }
                } else {
                    showError('ê°€ê²Œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Error loading store:', error);
                showError('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            } finally {
                showLoading(false);
            }
        }

        // ê°€ê²Œ ì‚­ì œ
        async function deleteStore(id) {
            if (!confirm('ì •ë§ ì´ ê°€ê²Œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            try {
                showLoading(true);
                const response = await fetch(`${API_BASE_URL}/stores/${id}`, {
                    method: 'DELETE'
                });
                const result = await response.json();
                
                if (result.success) {
                    showError('ê°€ê²Œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    await loadStores();
                } else {
                    showError(result.error || 'ê°€ê²Œ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Error deleting store:', error);
                showError('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            } finally {
                showLoading(false);
            }
        }

        // ê°€ê²Œ í¼ ì œì¶œ
        async function handleStoreSubmit(event) {
            event.preventDefault();
            
            // HTML5 ìœ íš¨ì„± ê²€ì‚¬ ìš°íšŒë¥¼ ìœ„í•´ required ì†ì„± ì¼ì‹œì ìœ¼ë¡œ ì œê±°
            const latInput = document.getElementById('storeLatitude');
            const lngInput = document.getElementById('storeLongitude');
            const hadRequiredLat = latInput.hasAttribute('required');
            const hadRequiredLng = lngInput.hasAttribute('required');
            if (hadRequiredLat) latInput.removeAttribute('required');
            if (hadRequiredLng) lngInput.removeAttribute('required');
            
            // í•„ìˆ˜ í•„ë“œ ê²€ì¦
            const storeName = document.getElementById('storeName').value.trim();
            if (!storeName) {
                showError('ìƒí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                if (hadRequiredLat) latInput.setAttribute('required', '');
                if (hadRequiredLng) lngInput.setAttribute('required', '');
                return;
            }

            const storeCategory = document.getElementById('storeCategory').value.trim();
            if (!storeCategory) {
                showError('ë¶„ë¥˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                if (hadRequiredLat) latInput.setAttribute('required', '');
                if (hadRequiredLng) lngInput.setAttribute('required', '');
                return;
            }
            
            const address = document.getElementById('storeAddress').value.trim();
            const roadAddress = document.getElementById('storeRoadAddress').value.trim();
            const lotAddress = document.getElementById('storeLotAddress').value.trim();
            
            // ìœ„ë„/ê²½ë„ ê°’ ê°€ì ¸ì˜¤ê¸° (ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ë˜ëŠ” ì˜¤ë¥˜ ì²˜ë¦¬)
            let latitude = parseFloat(document.getElementById('storeLatitude').value);
            let longitude = parseFloat(document.getElementById('storeLongitude').value);
            
            // ìœ„ë„/ê²½ë„ê°€ ì—†ìœ¼ë©´ ì£¼ì†Œ ê²€ìƒ‰ìœ¼ë¡œ ìë™ ì…ë ¥ ì‹œë„
            if (!latitude || !longitude || isNaN(latitude) || isNaN(longitude)) {
                if (address || roadAddress || lotAddress) {
                    showLoading(true);
                    try {
                        const searchAddressText = address || roadAddress || lotAddress;
                        const result = await searchAddressWithKakao(searchAddressText);
                        if (result && result.lat && result.lng) {
                            latitude = result.lat;
                            longitude = result.lng;
                            document.getElementById('storeLatitude').value = latitude.toFixed(6);
                            document.getElementById('storeLongitude').value = longitude.toFixed(6);
                            
                            // ë„ë¡œëª…/ì§€ë²ˆ ì£¼ì†Œê°€ ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ ì±„ìš°ê¸°
                            if (!roadAddress && result.roadAddress) {
                                document.getElementById('storeRoadAddress').value = result.roadAddress;
                            }
                            if (!lotAddress && result.jibunAddress) {
                                document.getElementById('storeLotAddress').value = result.jibunAddress;
                            }
                        } else {
                            showError('ìœ„ë„/ê²½ë„ë¥¼ ìë™ìœ¼ë¡œ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. "ì£¼ì†Œ ê²€ìƒ‰" ë²„íŠ¼ì„ í´ë¦­í•˜ê±°ë‚˜ ì§€ë„ë¥¼ í´ë¦­í•˜ì—¬ ìœ„ì¹˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                            showLoading(false);
                            return;
                        }
                    } catch (error) {
                        console.error('ì£¼ì†Œ ê²€ìƒ‰ ì˜¤ë¥˜:', error);
                        showError('ìœ„ë„/ê²½ë„ë¥¼ ìë™ìœ¼ë¡œ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. "ì£¼ì†Œ ê²€ìƒ‰" ë²„íŠ¼ì„ í´ë¦­í•˜ê±°ë‚˜ ì§€ë„ë¥¼ í´ë¦­í•˜ì—¬ ìœ„ì¹˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                        showLoading(false);
                        if (hadRequiredLat) latInput.setAttribute('required', '');
                        if (hadRequiredLng) lngInput.setAttribute('required', '');
                        return;
                    }
                    showLoading(false);
                } else {
                    showError('ì£¼ì†Œë¥¼ ì…ë ¥í•˜ê±°ë‚˜ "ì£¼ì†Œ ê²€ìƒ‰" ë²„íŠ¼ì„ í´ë¦­í•˜ê±°ë‚˜ ì§€ë„ë¥¼ í´ë¦­í•˜ì—¬ ìœ„ì¹˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    if (hadRequiredLat) latInput.setAttribute('required', '');
                    if (hadRequiredLng) lngInput.setAttribute('required', '');
                    return;
                }
            }
            
            // required ì†ì„± ë³µì› (í•„ìš”í•œ ê²½ìš°)
            if (hadRequiredLat) latInput.setAttribute('required', '');
            if (hadRequiredLng) lngInput.setAttribute('required', '');
            
            const storeData = {
                name: document.getElementById('storeName').value.trim(),
                address: address || roadAddress || lotAddress, // í‘œì‹œìš© ì£¼ì†Œ
                road_address: roadAddress || null, // ë„ë¡œëª… ì£¼ì†Œ (ë°ì´í„°ë² ì´ìŠ¤)
                lot_address: lotAddress || null, // ì§€ë²ˆ ì£¼ì†Œ (ë°ì´í„°ë² ì´ìŠ¤)
                latitude: latitude,
                longitude: longitude,
                phone: document.getElementById('storePhone').value.trim(),
                email: document.getElementById('storeEmail').value.trim(),
                category: document.getElementById('storeCategory').value.trim(),
                description: document.getElementById('storeDescription').value.trim()
            };

            try {
                showLoading(true);
                const url = editingStoreId 
                    ? `${API_BASE_URL}/stores/${editingStoreId}`
                    : `${API_BASE_URL}/stores`;
                
                const method = editingStoreId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(storeData)
                });

                const result = await response.json();
                
                if (result.success) {
                    closeStoreModal();
                    showError(editingStoreId ? 'ê°€ê²Œê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ê°€ê²Œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    await loadStores();
            } else {
                    showError(result.error || 'ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Error saving store:', error);
                showError('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            } finally {
                showLoading(false);
            }
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeStoreModal() {
            document.getElementById('storeModal').classList.remove('active');
            editingStoreId = null;
        }

        // ê°€ê²Œ í¬ì»¤ìŠ¤
        // ê°€ê²Œ ìœ„ì¹˜ë¡œ ì§€ë„ ì¤‘ì‹¬ ì´ë™ (Wizard ìŠ¤íƒ€ì¼)
        function focusStore(lat, lng, name) {
            if (!map) {
                return;
            }
            // ì´ë™í•  ìœ„ë„ ê²½ë„ ìœ„ì¹˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
            const position = new kakao.maps.LatLng(lat, lng);
            
            // ì§€ë„ ì¤‘ì‹¬ì„ ì´ë™í•©ë‹ˆë‹¤
            map.setCenter(position);
            
            // ì§€ë„ í™•ëŒ€ ë ˆë²¨ì„ ì„¤ì •í•©ë‹ˆë‹¤
            map.setLevel(3);
        }

        // ë§ˆì»¤ ì œê±° (ê°€ê²Œ ë§ˆì»¤ë§Œ)
        function clearMarkers() {
            markers.forEach(item => {
                if (item.marker) {
                    item.marker.setMap(null);
                }
                if (item.infowindow) {
                    item.infowindow.close();
                }
            });
            markers = [];
        }
        
        // ê²€ìƒ‰ ë§ˆì»¤ ì œê±°
        function clearSearchMarker() {
            if (searchMarker) {
                searchMarker.setMap(null);
                searchMarker = null;
            }
        }

        // ë¡œë”© í‘œì‹œ
        function showLoading(show) {
            const loading = document.getElementById('loading');
            if (show) {
                loading.classList.add('active');
            } else {
                loading.classList.remove('active');
            }
        }

        // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
        function showError(message) {
            const errorMsg = document.getElementById('errorMessage');
            errorMsg.textContent = message;
            errorMsg.classList.add('active');
            
            // ì—ëŸ¬ ë©”ì‹œì§€ì¸ ê²½ìš° alert ì°½ìœ¼ë¡œë„ í‘œì‹œ
            if (message.includes('ì‹¤íŒ¨') || message.includes('ì˜¤ë¥˜') || message.includes('ì—ëŸ¬') || message.includes('ì—†ìŠµë‹ˆë‹¤')) {
                window.alert('ì˜¤ë¥˜: ' + message);
            }
            
            setTimeout(() => {
                errorMsg.classList.remove('active');
            }, 3000);
        }

        function hideError() {
            document.getElementById('errorMessage').classList.remove('active');
        }

        // HTML ì´ìŠ¤ì¼€ì´í”„
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('searchBtn').addEventListener('click', function() {
            const address = document.getElementById('addressInput').value.trim();
            if (address) {
                searchAddress(address);
            } else {
                showError('ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            }
        });

        document.getElementById('addressInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('searchBtn').click();
            }
        });

        // ê°€ê²Œ ëª©ë¡ í† ê¸€
        document.getElementById('storeListHeader').addEventListener('click', function() {
            document.getElementById('storeList').classList.toggle('expanded');
        });

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.getElementById('storeModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeStoreModal();
            }
        });

        // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
        async function checkAuth() {
            try {
                const response = await fetch(`${API_BASE_URL}/auth/me`, {
                    credentials: 'include'
                });
                const result = await response.json();
                
                if (result.success && result.user) {
                    currentUser = result.user;
                    updateUI();
                } else {
                    currentUser = null;
                    updateUI();
                }
            } catch (error) {
                console.error('ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ì˜¤ë¥˜:', error);
                currentUser = null;
                updateUI();
            }
        }

        // UI ì—…ë°ì´íŠ¸
        function updateUI() {
            const loginForm = document.getElementById('loginForm');
            const userInfo = document.getElementById('userInfo');
            const usernameDisplay = document.getElementById('usernameDisplay');
            const userInfoButton = document.getElementById('userInfoButton');
            
            if (currentUser) {
                loginForm.style.display = 'none';
                userInfo.style.display = 'flex';
                if (usernameDisplay) {
                    usernameDisplay.textContent = `${currentUser.username}ë‹˜`;
                }
                
                // adminì¸ ê²½ìš° ë²„íŠ¼ í…ìŠ¤íŠ¸ì™€ ë™ì‘ ë³€ê²½
                if (userInfoButton) {
                    if (currentUser.username === 'admin') {
                        userInfoButton.textContent = 'ê´€ë¦¬ì í˜ì´ì§€';
                        userInfoButton.onclick = function() {
                            // Railwayì—ì„œ ì„¸ì…˜ ì„¤ì • ì§€ì—°ì„ ê³ ë ¤í•˜ì—¬ ì•½ê°„ì˜ ì§€ì—° ì¶”ê°€
                            setTimeout(() => {
                                window.location.href = '/admin.html';
                            }, 500);
                        };
                    } else {
                        userInfoButton.textContent = 'ë‚´ ì •ë³´';
                        userInfoButton.onclick = openUserInfoModal;
                    }
                }
            } else {
                loginForm.style.display = 'flex';
                userInfo.style.display = 'none';
            }
        }

        // ë¡œê·¸ì¸
        async function handleLogin() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                showError('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                showLoading(true);
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({ username, password })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    currentUser = result.user;
                    updateUI();
                    document.getElementById('loginUsername').value = '';
                    document.getElementById('loginPassword').value = '';
                    
                    // ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸í•œ ê²½ìš° ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ëª¨ë‹¬ ìë™ ì—´ê¸°
                    if (result.isTempPassword) {
                        showError('ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•´ì£¼ì„¸ìš”.');
                        await loadStores();
                        // ì•½ê°„ì˜ ì§€ì—° í›„ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ëª¨ë‹¬ ì—´ê¸°
                        setTimeout(() => {
                            openUserInfoModal();
                            // í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤
                            const currentPasswordInput = document.getElementById('userInfoCurrentPassword');
                            if (currentPasswordInput) {
                                currentPasswordInput.focus();
                            }
                        }, 500);
                    } else {
                        showError('ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        await loadStores(); // ê°€ê²Œ ëª©ë¡ ë‹¤ì‹œ ë¡œë“œ
                    }
                } else {
                    showError(result.error || 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                showError('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                showLoading(false);
            }
        }

        // ë¡œê·¸ì•„ì›ƒ
        async function logout() {
            try {
                showLoading(true);
                const response = await fetch(`${API_BASE_URL}/auth/logout`, {
                    method: 'POST',
                    credentials: 'include'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    currentUser = null;
                    updateUI();
                    showError('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
                    await loadStores(); // ê°€ê²Œ ëª©ë¡ ë‹¤ì‹œ ë¡œë“œ
                }
            } catch (error) {
                console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
                showError('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                showLoading(false);
            }
        }

        // íšŒì›ê°€ì… ëª¨ë‹¬ ì—´ê¸°
        function openRegisterModal() {
            // ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆê°€ ë“±ë¡ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
            const registerSubmitBtn = document.getElementById('registerSubmitBtn');
            if (registerSubmitBtn && !registerSubmitBtn.hasAttribute('data-listener-attached')) {
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆê°€ ì—†ìœ¼ë©´ ë“±ë¡
                initRegisterEventListeners();
            }
            const registerModal = document.getElementById('registerModal');
            document.getElementById('registerForm').reset();
            // ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ì œê±°í•˜ì—¬ CSS í´ë˜ìŠ¤ê°€ ì ìš©ë˜ë„ë¡ í•¨
            registerModal.style.display = '';
            registerModal.classList.add('active');
        }

        // íšŒì›ê°€ì… ëª¨ë‹¬ ë‹«ê¸°
        function closeRegisterModal() {
            const registerModal = document.getElementById('registerModal');
            if (registerModal) {
                registerModal.classList.remove('active');
                // ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ì œê±° (CSS í´ë˜ìŠ¤ë¡œë§Œ ì œì–´)
                registerModal.style.display = '';
            }
        }

        // íšŒì›ê°€ì… (ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€)
        let isRegistering = false;
        
        // ê°€ì… ë²„íŠ¼ í´ë¦­ í•¸ë“¤ëŸ¬ (ì§ì ‘ í˜¸ì¶œ)
        window.handleRegisterButtonClick = async function(event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            console.log('=== ê°€ì… ë²„íŠ¼ í´ë¦­ë¨ ===');
            
            // ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
            if (isRegistering) {
                console.log('ì´ë¯¸ íšŒì›ê°€ì… ì²˜ë¦¬ê°€ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤. ì¶”ê°€ ìš”ì²­ì„ ë¬´ì‹œí•©ë‹ˆë‹¤.');
                return;
            }
            
            const submitBtn = document.getElementById('registerSubmitBtn');
            
            try {
                showLoading(true);
                
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'ì²˜ë¦¬ ì¤‘...';
                }
                
                await handleRegister(event);
            } catch (error) {
                console.error('ê°€ì… ë²„íŠ¼ í´ë¦­ ì˜¤ë¥˜:', error);
                let errorMsg = 'ê°€ì… ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                
                if (error && error.message) {
                    errorMsg = error.message;
                } else if (error && error.toString) {
                    errorMsg = error.toString();
                }
                
                showError(errorMsg);
                alert('ì˜¤ë¥˜: ' + errorMsg);
            } finally {
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'ê°€ì…';
                }
                
                showLoading(false);
            }
        };
        
        window.handleRegister = async function handleRegister(event) {
            try {
                if (event) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                
                // ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
                if (isRegistering) {
                    console.log('ì´ë¯¸ íšŒì›ê°€ì… ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤. ì¶”ê°€ ìš”ì²­ì„ ë¬´ì‹œí•©ë‹ˆë‹¤.');
                    return;
                }
                
                isRegistering = true;
                console.log('=== handleRegister í˜¸ì¶œë¨ ===');
            
            const name = document.getElementById('registerName').value.trim();
            const username = document.getElementById('registerUsername').value.trim();
            const password = document.getElementById('registerPassword').value;
            const passwordConfirm = document.getElementById('registerPasswordConfirm').value;
            
            // ê°€ê²Œ ì •ë³´
            const storeName = document.getElementById('registerStoreName').value.trim();
            const storeCategory = document.getElementById('registerStoreCategory').value.trim();
            const storeAddress = document.getElementById('registerStoreAddress').value.trim();
            const storeRoadAddress = document.getElementById('registerStoreRoadAddress').value.trim();
            const storeLotAddress = document.getElementById('registerStoreLotAddress').value.trim();
            const storeLatitude = parseFloat(document.getElementById('registerStoreLatitude').value);
            const storeLongitude = parseFloat(document.getElementById('registerStoreLongitude').value);
            const storePhone = document.getElementById('registerStorePhone').value.trim();
            const storeEmail = document.getElementById('registerStoreEmail').value.trim();
            const storeDescription = document.getElementById('registerStoreDescription').value.trim();
            
            if (!name || !username || !password || !passwordConfirm) {
                const errorMsg = 'ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì„±ëª…, ì•„ì´ë””, ë¹„ë°€ë²ˆí˜¸, ë¹„ë°€ë²ˆí˜¸ í™•ì¸)';
                showError(errorMsg);
                alert('ì˜¤ë¥˜: ' + errorMsg);
                isRegistering = false;
                showLoading(false);
                return;
            }
            
            if (username.length < 3) {
                const errorMsg = 'ì•„ì´ë””ëŠ” 3ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                showError(errorMsg);
                alert('ì˜¤ë¥˜: ' + errorMsg);
                isRegistering = false;
                showLoading(false);
                return;
            }
            
            if (password.length < 4) {
                const errorMsg = 'ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                showError(errorMsg);
                alert('ì˜¤ë¥˜: ' + errorMsg);
                isRegistering = false;
                showLoading(false);
                return;
            }
            
            if (password !== passwordConfirm) {
                const errorMsg = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                showError(errorMsg);
                alert('ì˜¤ë¥˜: ' + errorMsg);
                isRegistering = false;
                showLoading(false);
                return;
            }
            
            if (!storeName || !storeCategory || !storeAddress) {
                const errorMsg = 'ê°€ê²Œ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”. (ìƒí˜¸, ë¶„ë¥˜, ì£¼ì†ŒëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤)';
                showError(errorMsg);
                alert('ì˜¤ë¥˜: ' + errorMsg);
                isRegistering = false;
                showLoading(false);
                return;
            }
            
            if (!storeLatitude || !storeLongitude || isNaN(storeLatitude) || isNaN(storeLongitude)) {
                const errorMsg = 'ì£¼ì†Œ ê²€ìƒ‰ì„ í†µí•´ ìœ„ì¹˜ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”. (ìœ„ë„/ê²½ë„ê°€ í•„ìš”í•©ë‹ˆë‹¤)';
                showError(errorMsg);
                alert('ì˜¤ë¥˜: ' + errorMsg);
                isRegistering = false;
                showLoading(false);
                return;
            }
            
            try {
                showLoading(true);
                
                const requestData = { 
                    name: name,
                    username, 
                    password,
                    store: {
                        name: storeName,
                        category: storeCategory,
                        address: storeAddress || storeRoadAddress || storeLotAddress,
                        road_address: storeRoadAddress,
                        lot_address: storeLotAddress,
                        latitude: storeLatitude,
                        longitude: storeLongitude,
                        phone: storePhone,
                        email: storeEmail,
                        description: storeDescription
                    }
                };
                
                console.log('íšŒì›ê°€ì… ìš”ì²­ ë°ì´í„°:', requestData);
                console.log('API í˜¸ì¶œ ì‹œì‘:', `${API_BASE_URL}/auth/register`);
                
                const response = await fetch(`${API_BASE_URL}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify(requestData)
                });
                
                console.log('íšŒì›ê°€ì… ì‘ë‹µ ìƒíƒœ:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('íšŒì›ê°€ì… ì‹¤íŒ¨:', errorText);
                    let errorMessage = 'ê°€ê²Œ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                    try {
                        const errorJson = JSON.parse(errorText);
                        errorMessage = errorJson.error || errorMessage;
                    } catch (e) {
                        if (response.status === 404) {
                            errorMessage = 'ì„œë²„ì— íšŒì›ê°€ì… APIê°€ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ë¥¼ ì¬ì‹œì‘í•´ì£¼ì„¸ìš”.';
                        } else if (response.status === 500) {
                            errorMessage = 'ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                        } else if (response.status === 400) {
                            errorMessage = 'ì…ë ¥í•œ ì •ë³´ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
                        } else {
                            errorMessage = `ì„œë²„ ì˜¤ë¥˜ (${response.status}): ${errorText.substring(0, 100)}`;
                        }
                    }
                    showError(errorMessage);
                    alert('ì˜¤ë¥˜: ' + errorMessage);
                    showLoading(false);
                    isRegistering = false;
                    return;
                }
                
                const result = await response.json();
                console.log('íšŒì›ê°€ì… ì‘ë‹µ:', result);
                
                if (result.success) {
                    console.log('íšŒì›ê°€ì… ì„±ê³µ! ì‚¬ìš©ì:', result.user);
                    currentUser = result.user;
                    
                    // ëª¨ë‹¬ ë¨¼ì € ë‹«ê¸°
                    closeRegisterModal();
                    
                    // UI ì—…ë°ì´íŠ¸
                    updateUI();
                    
                    // adminì´ë©´ admin í˜ì´ì§€ë¡œ ì´ë™
                    if (currentUser.username === 'admin') {
                        alert('ê°€ê²Œ ì¶”ê°€ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ì í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
                        setTimeout(() => {
                            window.location.href = '/admin.html';
                        }, 500);
                    } else {
                        alert('ê°€ê²Œ ì¶”ê°€ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        await loadStores(); // ê°€ê²Œ ëª©ë¡ ë‹¤ì‹œ ë¡œë“œ
                        console.log('ê°€ê²Œ ëª©ë¡ ë‹¤ì‹œ ë¡œë“œ ì™„ë£Œ');
                    }
                } else {
                    console.error('íšŒì›ê°€ì… ì‹¤íŒ¨:', result.error);
                    const errorMsg = result.error || 'ê°€ê²Œ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                    showError(errorMsg);
                    alert('ì˜¤ë¥˜: ' + errorMsg);
                }
            } catch (error) {
                console.error('íšŒì›ê°€ì… ì˜¤ë¥˜:', error);
                console.error('ì—ëŸ¬ ìŠ¤íƒ:', error.stack);
                let errorMsg = 'ê°€ê²Œ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                
                if (error.message) {
                    if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                        errorMsg = 'ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê±°ë‚˜ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.';
                    } else if (error.message.includes('timeout')) {
                        errorMsg = 'ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                    } else {
                        errorMsg = `ì˜¤ë¥˜: ${error.message}`;
                    }
                } else {
                    errorMsg = 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                }
                
                showError(errorMsg);
                alert('ì˜¤ë¥˜: ' + errorMsg);
            } finally {
                isRegistering = false;
                showLoading(false);
                console.log('=== handleRegister ì¢…ë£Œ ===');
            }
            } catch (outerError) {
                // ìµœìƒìœ„ ì—ëŸ¬ ì²˜ë¦¬
                console.error('handleRegister ìµœìƒìœ„ ì˜¤ë¥˜:', outerError);
                isRegistering = false;
                showLoading(false);
                const errorMsg = 'ê°€ì… ì²˜ë¦¬ ì¤‘ ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (outerError.message || outerError);
                showError(errorMsg);
                alert('ì˜¤ë¥˜: ' + errorMsg);
            }
        };

        // íšŒì›ê°€ì… ëª¨ë‹¬ì—ì„œ ì£¼ì†Œ ê²€ìƒ‰
        async function searchAddressFromRegisterModal() {
            console.log('=== searchAddressFromRegisterModal í˜¸ì¶œë¨ ===');
            
            const addressInput = document.getElementById('registerStoreAddress');
            if (!addressInput) {
                console.error('registerStoreAddress ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                showError('ì£¼ì†Œ ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const address = addressInput.value.trim();
            if (!address) {
                showError('ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            console.log('ê²€ìƒ‰í•  ì£¼ì†Œ:', address);
            
            if (!map || typeof kakao === 'undefined' || !kakao.maps) {
                showError('ì§€ë„ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                return;
            }

            showLoading(true);
            hideError();

            try {
                // Kakao Maps Geocoding API ì‚¬ìš©
                const kakaoResult = await searchAddressWithKakao(address);
                if (!kakaoResult || !kakaoResult.lat || !kakaoResult.lng) {
                    showLoading(false);
                    showError('ì£¼ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                const lat = kakaoResult.lat;
                const lng = kakaoResult.lng;
                const displayAddress = kakaoResult.displayAddress;
                const roadAddress = kakaoResult.roadAddress;
                const jibunAddress = kakaoResult.jibunAddress;

                console.log('ì£¼ì†Œ ê²€ìƒ‰ ì„±ê³µ:', { lat, lng, displayAddress, roadAddress, jibunAddress });

                // ê²€ìƒ‰ ê²°ê³¼ë¥¼ íšŒì›ê°€ì… ëª¨ë‹¬ í•„ë“œì— ì§ì ‘ ì…ë ¥
                const latInput = document.getElementById('registerStoreLatitude');
                const lngInput = document.getElementById('registerStoreLongitude');
                const roadAddressInput = document.getElementById('registerStoreRoadAddress');
                const lotAddressInput = document.getElementById('registerStoreLotAddress');
                
                if (latInput) {
                    latInput.value = lat.toFixed(6);
                    console.log('ìœ„ë„ ì…ë ¥:', lat.toFixed(6));
                }
                
                if (lngInput) {
                    lngInput.value = lng.toFixed(6);
                    console.log('ê²½ë„ ì…ë ¥:', lng.toFixed(6));
                }
                
                if (roadAddressInput) {
                    roadAddressInput.value = roadAddress || '';
                    console.log('ë„ë¡œëª… ì£¼ì†Œ ì…ë ¥:', roadAddress || '');
                }
                
                if (lotAddressInput) {
                    lotAddressInput.value = jibunAddress || '';
                    console.log('ì§€ë²ˆ ì£¼ì†Œ ì…ë ¥:', jibunAddress || '');
                }
                
                // ì£¼ì†Œ ì…ë ¥ í•„ë“œë„ ì—…ë°ì´íŠ¸
                if (addressInput) {
                    addressInput.value = roadAddress || jibunAddress || displayAddress;
                }
                
                // ì§€ë„ì— ë§ˆì»¤ í‘œì‹œ
                if (searchMarker) {
                    searchMarker.setMap(null);
                    searchMarker = null;
                }
                
                const markerPosition = new kakao.maps.LatLng(lat, lng);
                
                const imageSrc = 'data:image/svg+xml;base64,' + btoa(`
                    <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="10" fill="#ff0000" stroke="#ffffff" stroke-width="3"/>
                    </svg>
                `);
                
                const imageSize = new kakao.maps.Size(24, 24);
                const imageOption = { offset: new kakao.maps.Point(12, 12) };
                const markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption);
                
                searchMarker = new kakao.maps.Marker({
                    position: markerPosition,
                    image: markerImage
                });
                
                searchMarker.setMap(map);
                
                // ì¸í¬ìœˆë„ìš° í‘œì‹œ
                const iwContent = `
                    <div style="padding: 8px; min-width: 200px; text-align: center;">
                        <div style="font-weight: bold; color: #ff0000; margin-bottom: 5px;">ğŸ“ ê²€ìƒ‰ ìœ„ì¹˜</div>
                        <div style="font-size: 12px; color: #666;">${escapeHtml(displayAddress)}</div>
                        ${roadAddress && roadAddress !== displayAddress ? `<div style="font-size: 11px; color: #888; margin-top: 3px;">ë„ë¡œëª…: ${escapeHtml(roadAddress)}</div>` : ''}
                        ${jibunAddress && jibunAddress !== displayAddress && jibunAddress !== roadAddress ? `<div style="font-size: 11px; color: #888; margin-top: 3px;">ì§€ë²ˆ: ${escapeHtml(jibunAddress)}</div>` : ''}
                    </div>
                `;
                
                const infowindow = new kakao.maps.InfoWindow({ content: iwContent });
                infowindow.open(map, searchMarker);
                
                // ì§€ë„ ì¤‘ì‹¬ ì´ë™
                map.setCenter(markerPosition);
                map.setLevel(3);
                
                showLoading(false);
                // ì„±ê³µ ë©”ì‹œì§€ (showErrorëŠ” ì—ëŸ¬ ìŠ¤íƒ€ì¼ì´ì§€ë§Œ ë©”ì‹œì§€ ì „ë‹¬ìš©ìœ¼ë¡œ ì‚¬ìš©)
                const errorMsg = document.getElementById('errorMessage');
                if (errorMsg) {
                    errorMsg.textContent = 'ì£¼ì†Œ ê²€ìƒ‰ ì™„ë£Œ! ìœ„ë„/ê²½ë„ê°€ ìë™ìœ¼ë¡œ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    errorMsg.style.color = '#28a745';
                    errorMsg.classList.add('active');
                    setTimeout(() => {
                        errorMsg.classList.remove('active');
                    }, 3000);
                }
                console.log('ì£¼ì†Œ ê²€ìƒ‰ ì™„ë£Œ');
            } catch (error) {
                console.error('ì£¼ì†Œ ê²€ìƒ‰ ì˜¤ë¥˜:', error);
                showLoading(false);
                showError('ì£¼ì†Œ ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ì‚¬ìš©ì ì •ë³´ ëª¨ë‹¬ì—ì„œ ì£¼ì†Œ ê²€ìƒ‰
        async function searchAddressFromUserInfoModal() {
            const addressInput = document.getElementById('userInfoStoreAddress');
            if (!addressInput) {
                showError('ì£¼ì†Œ ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const address = addressInput.value.trim();
            if (!address) {
                showError('ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (!map || typeof kakao === 'undefined' || !kakao.maps) {
                showError('ì§€ë„ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                return;
            }

            showLoading(true);
            hideError();

            try {
                const kakaoResult = await searchAddressWithKakao(address);
                if (!kakaoResult || !kakaoResult.lat || !kakaoResult.lng) {
                    showLoading(false);
                    showError('ì£¼ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                const lat = kakaoResult.lat;
                const lng = kakaoResult.lng;
                const displayAddress = kakaoResult.displayAddress;
                const roadAddress = kakaoResult.roadAddress;
                const jibunAddress = kakaoResult.jibunAddress;

                const latInput = document.getElementById('userInfoStoreLatitude');
                const lngInput = document.getElementById('userInfoStoreLongitude');
                const roadAddressInput = document.getElementById('userInfoStoreRoadAddress');
                const lotAddressInput = document.getElementById('userInfoStoreLotAddress');

                if (latInput) {
                    latInput.value = lat.toFixed(6);
                }
                if (lngInput) {
                    lngInput.value = lng.toFixed(6);
                }
                if (roadAddressInput) {
                    roadAddressInput.value = roadAddress || '';
                }
                if (lotAddressInput) {
                    lotAddressInput.value = jibunAddress || '';
                }

                addressInput.value = roadAddress || jibunAddress || displayAddress;

                if (searchMarker) {
                    searchMarker.setMap(null);
                    searchMarker = null;
                }

                const markerPosition = new kakao.maps.LatLng(lat, lng);

                const imageSrc = 'data:image/svg+xml;base64,' + btoa(`
                    <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="10" fill="#ff0000" stroke="#ffffff" stroke-width="3"/>
                    </svg>
                `);

                const imageSize = new kakao.maps.Size(24, 24);
                const imageOption = { offset: new kakao.maps.Point(12, 12) };
                const markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption);

                searchMarker = new kakao.maps.Marker({
                    position: markerPosition,
                    image: markerImage
                });

                searchMarker.setMap(map);

                const storeNameInput = document.getElementById('userInfoStoreName');
                const storeName = storeNameInput ? storeNameInput.value.trim() : 'ê²€ìƒ‰ ìœ„ì¹˜';

                const infowindow = new kakao.maps.InfoWindow({
                    content: `
                        <div style="padding: 8px; min-width: 200px; text-align: center;">
                            <div style="font-weight: bold; color: #ff0000; margin-bottom: 5px;">ğŸ“ ${escapeHtml(storeName)}</div>
                            <div style="font-size: 12px; color: #666;">${escapeHtml(displayAddress)}</div>
                            ${roadAddress && roadAddress !== displayAddress ? `<div style="font-size: 11px; color: #888; margin-top: 3px;">ë„ë¡œëª…: ${escapeHtml(roadAddress)}</div>` : ''}
                            ${jibunAddress && jibunAddress !== displayAddress && jibunAddress !== roadAddress ? `<div style="font-size: 11px; color: #888; margin-top: 3px;">ì§€ë²ˆ: ${escapeHtml(jibunAddress)}</div>` : ''}
                        </div>
                    `
                });

                infowindow.open(map, searchMarker);

                map.setCenter(markerPosition);
                map.setLevel(3);

                showLoading(false);
                const errorMsg = document.getElementById('errorMessage');
                if (errorMsg) {
                    errorMsg.textContent = 'ì£¼ì†Œ ê²€ìƒ‰ ì™„ë£Œ! ìœ„ë„/ê²½ë„ê°€ ìë™ìœ¼ë¡œ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    errorMsg.style.color = '#28a745';
                    errorMsg.classList.add('active');
                    setTimeout(() => {
                        errorMsg.classList.remove('active');
                        errorMsg.style.color = '#ffffff';
                    }, 3000);
                }
            } catch (error) {
                console.error('ì£¼ì†Œ ê²€ìƒ‰ ì˜¤ë¥˜:', error);
                showLoading(false);
                showError('ì£¼ì†Œ ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ì‚¬ìš©ì ì •ë³´ ëª¨ë‹¬ ì—´ê¸°
        async function openUserInfoModal() {
            console.log('=== openUserInfoModal í˜¸ì¶œë¨ ===');
            const userInfoModal = document.getElementById('userInfoModal');
            if (!userInfoModal) {
                console.error('userInfoModalì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                showError('ëª¨ë‹¬ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            try {
                showLoading(true);
                
                // ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const userResponse = await fetch(`${API_BASE_URL}/auth/me`, {
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!userResponse.ok) {
                    throw new Error(`HTTP ${userResponse.status}: ${userResponse.statusText}`);
                }
                
                const userResult = await userResponse.json();
                console.log('ì‚¬ìš©ì ì •ë³´ ì‘ë‹µ:', userResult);
                
                if (!userResult.success || !userResult.user) {
                    showError(userResult.error || 'ë¡œê·¸ì¸ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    showLoading(false);
                    return;
                }
                
                // ì‚¬ìš©ìì˜ ê°€ê²Œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const storesResponse = await fetch(`${API_BASE_URL}/stores`, {
                    credentials: 'include'
                });
                const storesResult = await storesResponse.json();
                
                let store = null;
                if (storesResult.success && storesResult.data && storesResult.data.length > 0) {
                    store = storesResult.data[0]; // ì²« ë²ˆì§¸ ê°€ê²Œ (ì‚¬ìš©ìë‹¹ 1ê°œ)
                }
                
                // ì‚¬ìš©ì ì •ë³´ ì…ë ¥
                const nameInput = document.getElementById('userInfoName');
                if (nameInput) {
                    nameInput.value = userResult.user.name || '';
                    nameInput.dataset.originalName = userResult.user.name || '';
                }
                
                const usernameInput = document.getElementById('userInfoUsername');
                if (usernameInput) {
                    usernameInput.value = userResult.user.username || '';
                }
                
                // ê°€ê²Œ ì •ë³´ ì…ë ¥
                if (store) {
                    const storeNameInput = document.getElementById('userInfoStoreName');
                    const categoryInput = document.getElementById('userInfoStoreCategory');
                    const addressInput = document.getElementById('userInfoStoreAddress');
                    const roadAddressInput = document.getElementById('userInfoStoreRoadAddress');
                    const lotAddressInput = document.getElementById('userInfoStoreLotAddress');
                    const latInput = document.getElementById('userInfoStoreLatitude');
                    const lngInput = document.getElementById('userInfoStoreLongitude');
                    const phoneInput = document.getElementById('userInfoStorePhone');
                    const emailInput = document.getElementById('userInfoStoreEmail');
                    const descInput = document.getElementById('userInfoStoreDescription');
                    
                    if (storeNameInput) storeNameInput.value = store.name || '';
                    if (categoryInput) categoryInput.value = store.category || '';
                    if (addressInput) addressInput.value = store.road_address || store.address || '';
                    if (roadAddressInput) roadAddressInput.value = store.road_address || '';
                    if (lotAddressInput) lotAddressInput.value = store.lot_address || '';
                    if (latInput) latInput.value = store.latitude || '';
                    if (lngInput) lngInput.value = store.longitude || '';
                    if (phoneInput) phoneInput.value = store.phone || '';
                    if (emailInput) emailInput.value = store.email || '';
                    if (descInput) descInput.value = store.description || '';
                }
                
                // ëª¨ë‹¬ ì—´ê¸°
                userInfoModal.classList.add('active');
                userInfoModal.style.display = 'flex';
                console.log('ë‚´ ì •ë³´ ëª¨ë‹¬ ì—´ê¸° ì„±ê³µ');
            } catch (error) {
                console.error('ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
                showError('ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        // ì‚¬ìš©ì ì •ë³´ ëª¨ë‹¬ ë‹«ê¸°
        function closeUserInfoModal() {
            const userInfoModal = document.getElementById('userInfoModal');
            const userInfoForm = document.getElementById('userInfoForm');
            
            if (userInfoModal) {
                userInfoModal.classList.remove('active');
                userInfoModal.style.display = 'none';
            }
            
            if (userInfoForm) {
                userInfoForm.reset();
            }
        }

        // ì‚¬ìš©ì ì •ë³´ ìˆ˜ì • (ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€)
        let isUpdatingUserInfo = false;
        async function handleUserInfoUpdate(event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            // ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
            if (isUpdatingUserInfo) {
                console.log('ì´ë¯¸ ì—…ë°ì´íŠ¸ ì¤‘ì…ë‹ˆë‹¤. ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€');
                return;
            }
            
            isUpdatingUserInfo = true;
            console.log('=== handleUserInfoUpdate í˜¸ì¶œë¨ (index.html) ===');
            
            try {
                const nameInput = document.getElementById('userInfoName');
                const currentPassword = document.getElementById('userInfoCurrentPassword').value;
                const newPassword = document.getElementById('userInfoNewPassword').value;
                const newPasswordConfirm = document.getElementById('userInfoNewPasswordConfirm').value;
                
                // ì‚¬ìš©ì ì •ë³´
                const name = nameInput ? nameInput.value.trim() : '';
                const originalName = nameInput && nameInput.dataset.originalName ? nameInput.dataset.originalName : '';
                const hasNameChange = nameInput !== null && name !== originalName;
            
                // ê°€ê²Œ ì •ë³´
                const storeName = document.getElementById('userInfoStoreName').value.trim();
                const storeCategory = document.getElementById('userInfoStoreCategory').value.trim();
                const storeAddress = document.getElementById('userInfoStoreAddress').value.trim();
                const storeRoadAddress = document.getElementById('userInfoStoreRoadAddress').value.trim();
                const storeLotAddress = document.getElementById('userInfoStoreLotAddress').value.trim();
                const storeLatitude = parseFloat(document.getElementById('userInfoStoreLatitude').value);
                const storeLongitude = parseFloat(document.getElementById('userInfoStoreLongitude').value);
                const storePhone = document.getElementById('userInfoStorePhone').value.trim();
                const storeEmail = document.getElementById('userInfoStoreEmail').value.trim();
                const storeDescription = document.getElementById('userInfoStoreDescription').value.trim();
                
                if (!storeName || !storeCategory || !storeAddress) {
                    const errorMsg = 'ê°€ê²Œ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                    showError(errorMsg);
                    alert('ì˜¤ë¥˜: ' + errorMsg);
                    isUpdatingUserInfo = false;
                    return;
                }
                
                if (!storeLatitude || !storeLongitude || isNaN(storeLatitude) || isNaN(storeLongitude)) {
                    const errorMsg = 'ì£¼ì†Œ ê²€ìƒ‰ì„ í†µí•´ ìœ„ì¹˜ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.';
                    showError(errorMsg);
                    alert('ì˜¤ë¥˜: ' + errorMsg);
                    isUpdatingUserInfo = false;
                    return;
                }
                
                // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì‹œ ê²€ì¦
                if (newPassword || newPasswordConfirm) {
                    if (!currentPassword) {
                        const errorMsg = 'í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                        showError(errorMsg);
                        alert('ì˜¤ë¥˜: ' + errorMsg);
                        isUpdatingUserInfo = false;
                        return;
                    }
                    
                    if (newPassword.length < 4) {
                        const errorMsg = 'ìƒˆ ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                        showError(errorMsg);
                        alert('ì˜¤ë¥˜: ' + errorMsg);
                        isUpdatingUserInfo = false;
                        return;
                    }
                    
                    if (newPassword !== newPasswordConfirm) {
                        const errorMsg = 'ìƒˆ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                        showError(errorMsg);
                        alert('ì˜¤ë¥˜: ' + errorMsg);
                        isUpdatingUserInfo = false;
                        return;
                    }
                }
                
                showLoading(true);
                
                // í”„ë¡œí•„ ì—…ë°ì´íŠ¸ (ì„±ëª…)
                if (hasNameChange) {
                    const profileResponse = await fetch(`${API_BASE_URL}/auth/update-profile`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        credentials: 'include',
                        body: JSON.stringify({ name: name })
                    });
                    
                    const profileResult = await profileResponse.json();
                    
                    if (!profileResult.success) {
                        const errorMsg = profileResult.error || 'í”„ë¡œí•„ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                        showError(errorMsg);
                        alert('ì˜¤ë¥˜: ' + errorMsg);
                        isUpdatingUserInfo = false;
                        showLoading(false);
                        return;
                    }
                }
                
                // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
                if (newPassword) {
                    const passwordResponse = await fetch(`${API_BASE_URL}/auth/change-password`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        credentials: 'include',
                        body: JSON.stringify({
                            currentPassword,
                            newPassword
                        })
                    });
                    
                    const passwordResult = await passwordResponse.json();
                    
                    if (!passwordResult.success) {
                        const errorMsg = passwordResult.error || 'ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                        showError(errorMsg);
                        alert('ì˜¤ë¥˜: ' + errorMsg);
                        isUpdatingUserInfo = false;
                        showLoading(false);
                        return;
                    }
                    
                    // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì„±ê³µ ì‹œ í•„ë“œ ì´ˆê¸°í™”
                    document.getElementById('userInfoCurrentPassword').value = '';
                    document.getElementById('userInfoNewPassword').value = '';
                    document.getElementById('userInfoNewPasswordConfirm').value = '';
                }
                
                // ê°€ê²Œ ì •ë³´ ìˆ˜ì •
                const storesResponse = await fetch(`${API_BASE_URL}/stores`, {
                    credentials: 'include'
                });
                const storesResult = await storesResponse.json();
                
                let storeId = null;
                if (storesResult.success && storesResult.data && storesResult.data.length > 0) {
                    storeId = storesResult.data[0].id;
                }
                
                if (storeId) {
                    // ê¸°ì¡´ ê°€ê²Œ ìˆ˜ì •
                    const updateResponse = await fetch(`${API_BASE_URL}/stores/${storeId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        credentials: 'include',
                        body: JSON.stringify({
                            name: storeName,
                            category: storeCategory,
                            address: storeAddress || storeRoadAddress || storeLotAddress,
                            road_address: storeRoadAddress,
                            lot_address: storeLotAddress,
                            latitude: storeLatitude,
                            longitude: storeLongitude,
                            phone: storePhone,
                            email: storeEmail,
                            description: storeDescription
                        })
                    });
                    
                    const updateResult = await updateResponse.json();
                    
                    if (!updateResult.success) {
                        const errorMsg = updateResult.error || 'ê°€ê²Œ ì •ë³´ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                        showError(errorMsg);
                        alert('ì˜¤ë¥˜: ' + errorMsg);
                        isUpdatingUserInfo = false;
                        showLoading(false);
                        return;
                    }
                } else {
                    // ìƒˆ ê°€ê²Œ ì¶”ê°€
                    const addResponse = await fetch(`${API_BASE_URL}/stores`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        credentials: 'include',
                        body: JSON.stringify({
                            name: storeName,
                            category: storeCategory,
                            address: storeAddress || storeRoadAddress || storeLotAddress,
                            road_address: storeRoadAddress,
                            lot_address: storeLotAddress,
                            latitude: storeLatitude,
                            longitude: storeLongitude,
                            phone: storePhone,
                            email: storeEmail,
                            description: storeDescription
                        })
                    });
                    
                    const addResult = await addResponse.json();
                    
                    if (!addResult.success) {
                        const errorMsg = addResult.error || 'ê°€ê²Œ ì •ë³´ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                        showError(errorMsg);
                        alert('ì˜¤ë¥˜: ' + errorMsg);
                        isUpdatingUserInfo = false;
                        showLoading(false);
                        return;
                    }
                }
                
                closeUserInfoModal();
                showError('ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                await loadStores();
            } catch (error) {
                console.error('ì‚¬ìš©ì ì •ë³´ ìˆ˜ì • ì˜¤ë¥˜:', error);
                const errorMsg = 'ì •ë³´ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message;
                showError(errorMsg);
                alert('ì˜¤ë¥˜: ' + errorMsg);
            } finally {
                isUpdatingUserInfo = false;
                showLoading(false);
                console.log('=== handleUserInfoUpdate ì¢…ë£Œ (index.html) ===');
            }
        }

        // ë¡œê·¸ì¸ í¼ì—ì„œ Enter í‚¤ ì²˜ë¦¬
        document.getElementById('loginPassword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                handleLogin();
            }
        });

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸° (íšŒì›ê°€ì… ëª¨ë‹¬)
        document.getElementById('registerModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeRegisterModal();
            }
        });
        
        // DOM ë¡œë“œ í›„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        function initRegisterEventListeners() {
            // íšŒì›ê°€ì… í¼ ì œì¶œ ì´ë²¤íŠ¸ ì§ì ‘ ì—°ê²°
            const registerForm = document.getElementById('registerForm');
            if (registerForm) {
                registerForm.addEventListener('submit', async function(e) {
                    try {
                        console.log('íšŒì›ê°€ì… í¼ submit ì´ë²¤íŠ¸ ë°œìƒ');
                        await window.handleRegisterButtonClick(e);
                    } catch (error) {
                        console.error('íšŒì›ê°€ì… í¼ ì œì¶œ ì˜¤ë¥˜:', error);
                        const errorMsg = 'ê°€ì… í¼ ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (error.message || error);
                        showError(errorMsg);
                        alert('ì˜¤ë¥˜: ' + errorMsg);
                    }
                    return false;
                });
                console.log('registerForm ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
            }
            
            // íšŒì›ê°€ì… ë²„íŠ¼ ì§ì ‘ ì—°ê²°
            const registerSubmitBtn = document.getElementById('registerSubmitBtn');
            if (registerSubmitBtn) {
                registerSubmitBtn.addEventListener('click', async function(e) {
                    await window.handleRegisterButtonClick(e);
                });
                registerSubmitBtn.setAttribute('data-listener-attached', 'true');
                console.log('registerSubmitBtn ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
            } else {
                console.error('registerSubmitBtnì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
            }
        }
        
        // DOM ë¡œë“œ ì™„ë£Œ í›„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initRegisterEventListeners);
        } else {
            // DOMì´ ì´ë¯¸ ë¡œë“œëœ ê²½ìš° ì¦‰ì‹œ ì‹¤í–‰
            initRegisterEventListeners();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', function() {
            // Kakao Maps APIëŠ” initMapì—ì„œ ë¡œë“œ ëŒ€ê¸°ë¥¼ ìˆ˜í–‰
            initMap();
            checkAuth().then(() => {
                loadStores();
            });
        });

    </script>
</body>
</html>